<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://adi.nicolaiweitkemper.de/Database2/js.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
<html>

<head>
  <title>Geduldspiel</title>
  <canvas id="textur" width="1582" onclick="canvasClicked();" height="740"></canvas>
  <p><img id="preview"></p>
  <meta name="viewport" content="width=device-width,user-scalable=yes" />
  <div id="ball">
    <style>
      .shape {
   position: absolute;
   width: 50px;
   height: 50px;
   -webkit-radius: 50px;
   margin:0;width
   padding:0;
  }
  #sphere1{
   border-radius: 50px;
   background-color: blue;
  }
  </style>
  </div>
</head>

<body>
  <div id="content">
    <div class="shape" id="sphere1"></div>
  </div>
  <br>
  <div class="" id="levelEditTool">
  <button type="button" id="back" onclick="folgenKeyPressed({key: 'z', ctrlKey: true})" name="button">←</button>
  <button type="button" onclick="select(name)" id="rotatingWall" name="rotatingWall">rotierendes Viereck</button>
  <button type="button" onclick="select(name)" id="blinkWall" name="blinkWall">blinkendes Viereck</button>
  <button type="button" style="background: ''" onclick="select(name)" id="rotatingDreieck" name="rotatingDreieck">rotierendesDreieck</button>
  <button type="button" id="setSpawnpoint" onclick='AblageListe[9] = "setSpawnpoint";' name="button">set spawnpoint</button>
  <input type="range" min="7" onchange="sliderBallSizeChanged(value);" oninput="sliderBallSizeOnChange(value)" max="500" value="50" class="slider" id="sliderBallSize">
  <input type="range" min="1" onchange="changedSlider(id)" oninput="changing(id)" max="1500" value="55" size="277" width="277" class="slider" id="sliderWidth">
  <input type="range" min="1" onchange="changedSlider(id)" oninput="changing(id)" max="800" value="55" class="slider" id="sliderHeight">
  <input type="range" min="1" onchange="changedSlider(id)" oninput="changing(id)" max="200" value="37" class="slider" id="sliderSize">
  <input type="text" placeholder="angle(ca.°)" value="0" onchange="changeTextbox(id)" id="angle"></input>
  <input type="text" placeholder="time for 360° Rotation in mili secs" onchange="changeTextbox(id)" id="timeFor360GradRotation" value="1000"></input>

  <input type="text" placeholder="time visible" onchange="changeTextbox(id)" id="timeVisible" value="3000"></input>
  <input type="text" placeholder="time invisible" onchange="changeTextbox(id)" id="timeInvisible" value="3000"></input>
  <button type="button" id="select" onclick="selected()" name="button">select</button>
  <button type="button" id="save" onclick="folgenKeyPressed({key: 's', ctrlKey: true})" name="button">save</button>
  <button type="button" id="testLevel" onclick="testLevel();" name="button">test Level</button>
  <button type="button" id="uploadLevel" onclick="uploadLevel()" name="button">upload level</button>
  <button type="button" id="forward" onclick="folgenKeyPressed({key: 'y', ctrlKey: true})" name="button">→</button>
  <br>
  <br>
  <p id="pictureSelection">select Picture as level from PC<input type="file" onchange="imageLoaded(this);"></p>
  <select name="course" id="courceSelectionEdit" onchange="courceSelectedEdit(value)">Hintergrund von vorgefertigten Leveln auswählen</select>
  </div>
  <head>
    <style>
      table, td {
  border: 1px solid black;
}
</style>
  </head>
  <h2>sensibility: </h2>
  <input type="range" min="1" onchange="sensibility(document.getElementById('sensibility').value)" max="35" value="5" class="slider" id="sensibility">
  <button type="button" id="normalSensibility" onclick="sensibility(level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility, true)" name="button">back to normal</button>
  <table id="scores">
    <!-- <tr>
    <td>Row1 cell1</td>
    <td>Row1 cell2</td>
  </tr>
  <tr>
    <td>Row2 cell1</td>
    <td>Row2 cell2</td>
  </tr>
  <tr>
    <td>Row3 cell1</td>
    <td>Row3 cell2</td>
  </tr> -->
  </table>
  <br>
  <br>
  <div id="app">
    <li v-for="title in db" id="levelNames">
      {{ title }}
    </li>
  </div>
  <input type="color" onchange="ballColourChanged(value);" name="color" id="colourPicker">
  <select name="course" id="ballStyleSelection" value="normal" onchange="ballStyleSelected(value);">
    <option value="normal">normal</option>
    <option value="pick colour">pick colour</option>
    <option value="party">party</option>
  </select>
  <br>
  <select name="course" id="courceSelection" onchange="courceSelected(true)">
  </select>
  <br>
  <select name="course" id="modeSelection" value="move" onchange="modeSelected(value, true);">
    <option value="normal">normal</option>
    <option value="growing">growing</option>
    <option value="survive">survive</option>
    <option value="opposite">opposite</option>
    <option value="againstThePC">against the PC</option>
  </select>
  <br>
  <button type="button" id="saveMaps" onclick="saveMapsVorgefertigt()" name="button">save vorgefertigt maps and other data on device for offline mode</button>
  <h1 id="nameEingeloggt" onclick='name = prompt ("Mit welchem Namen wollen sie sich eingloggen?"); nameEingeloggt.innerHTML = "als " + name + " eingeloggt"'></h1>
  <script type="text/javascript">

  visible([
    // ['ballStyleSelection', "none"],
    ['colourPicker', "none"]
  ]);
  var inOrAgainstDirection = 1;
  var sphere1 = document.getElementById("sphere1");
  var growing;
  function ballStyleSelected(value) {
    if (value == "normal")  sphere1.style.backgroundColor = "blue";
    if (value == "pick colour") visible([["colourPicker", "inline"]]);
}
function ballColourChanged (value) {
  sphere1.style.backgroundColor = value;
  visible([['colourPicker', "none"]]);
}
  function modeSelected(value) {
    clearInterval(growing);
    level[value].editLevel.selected = ["blinkWall", 0];
    if (value == "growing") {
      sphere1.style.width =  level.growing[level.growing.levelType][level.growing.number].beginningSize.x/*(window.innerWidth / 40 + 66) / 2*/ + "px";
      sphere1.style.height = level.growing[level.growing.levelType][level.growing.number].beginningSize.y/*(window.innerHeight / 40 + 66) / 2*/ + "px";
      growing = setInterval(function () {
        if (level.growing.levelType != "editHistory") {
          sphere1.style.width = (JSON.parse(sphere1.style.width.toString().split('px')[0]) + level.growing[level.growing.levelType][level.growing.number].pixelPer7MiliSecGrowing) + "px";
          sphere1.style.height = (JSON.parse(sphere1.style.height.toString().split('px')[0]) + level.growing[level.growing.levelType][level.growing.number].pixelPer7MiliSecGrowing) + "px";
          // level.growing[level.growing.levelType][level.growing.number].spawnPoint.x = window.innerWidth/2 - JSON.parse(sphere1.style.width.toString().split('px')[0]) + 77;
          // level.growing[level.growing.levelType][level.growing.number].spawnPoint.y = window.innerHeight/2 - JSON.parse(sphere1.style.height.toString().split('px')[0]);
        }
      }, 7);
    }
    else {
      sphere1.style.width = (window.innerWidth / 40 + 66) / 2 + "px";
      sphere1.style.height = (window.innerWidth / 40 + 66) / 2 + "px";
    }
    if (value == "opposite") inOrAgainstDirection = -1;
    else inOrAgainstDirection = 1;
    if (value != level.mode) {
      level.mode = value;
      while (document.getElementById('courceSelection').options.length > 0) {
        document.getElementById('courceSelection').options[0] = undefined;
      }
      opt = document.createElement("option");
      document.getElementById("courceSelection").options.add(opt);
      opt.setAttribute("id", i);
      opt.text = "level";
    for (var i = 0; i < Object.keys(level[level.mode].vorgefertigt).length; i++) {
      opt = document.createElement("option");
      document.getElementById("courceSelection").options.add(opt);
      opt.setAttribute("id", i);
      opt.text = (i + 1) + ". map"
    }
    if (highscores[level.mode][name].length == Object.keys(level[level.mode].vorgefertigt).length) {
      opt = document.createElement("option");
      document.getElementById("courceSelection").options.add(opt);
      opt.setAttribute("id", "winnerScreen");
      opt.text = "winner screen";
    }
    opt = document.createElement("option");
    document.getElementById("courceSelection").options.add(opt);
    opt.setAttribute("id", i + 1);
    opt.text = "show scores";
    opt = document.createElement("option");
    document.getElementById("courceSelection").options.add(opt);
    opt.setAttribute("id", i + 2);
    opt.text = "upload own level";
    opt = document.createElement("option");
    document.getElementById("courceSelection").options.add(opt);
    opt.setAttribute("id", i + 2);
    opt.text = "play from world wide web";
  }

    level.mode = value;
  //  startPause();
  }
  function sensibility(value, backToNormal) {
//    if (value == level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility || level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "editHistory") {
      if (backToNormal == true || level[level.mode].levelType == "editHistory" || level[level.mode].levelType == "editLevel" || !(confirm('WARNING: When the sensibility is not normal, you will not get any score for that! (If you want to go back to normal, please click on "cancel")'))) value = level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility;
      if ((level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "editHistory") && backToNormal == true) value = level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility;
      if (level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "editHistory") {level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility = document.getElementById('sensibility').value; value = document.getElementById('sensibility').value;}
      document.getElementById('sensibility').value = value;
      window.ondevicemotion = function(e) {
        ax1 = inOrAgainstDirection*event.accelerationIncludingGravity.x * value;
        ay1 = inOrAgainstDirection*event.accelerationIncludingGravity.y * value;
    }
  }
    function changing(id) {
      //  console.log(document.getElementById('sliderWidth').value);
      // if (id == "")
      //if (!(level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] == "Layout")) AblageListe[7] = JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"]));
      //level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] = "Layout";
      level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]][id.replace("slider", "").toLowerCase()] = JSON.parse(JSON.stringify(document.getElementById(id).value))
      Layout();
      // setTimeout(function () {
      //   Layout();
      // }, 100);
    }
    // function spawnpointSet() {
    //   AblageListe[7] = "setSpawnpoint";
    // }
    function sliderBallSizeOnChange(radius) {
      Layout(true);
      canvas.fillStyle = "blue"
      canvas.beginPath();
      canvas.arc(level[level.mode].editHistory.spawnPoint.x + JSON.parse(radius), level[level.mode].editHistory.spawnPoint.y + JSON.parse(radius),radius,0,Math.PI*2, false);
      canvas.fill();
    }
    function sliderBallSizeChanged(radius) {
      level[level.mode].editHistory.ballSize = radius*2;
      sphere1.style.width = radius*2;
      sphere1.style.height = radius*2;
      }
    function changedSlider(id) {
      level[level.mode].editHistory.push(JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].stepOfHistory] /*[level[level.mode].editHistory.length - 1]*/ )));
      //  if (level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] == "Layout") level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] = AblageListe[0]
      //  level[level.mode].stepOfHistory++;
      level[level.mode].stepOfHistory = level[level.mode].editHistory.length - 1;
      Layout(false);
    }

    function changeTextbox(id) {
      if (!(isNaN(document.getElementById(id).value))) {
        level[level.mode].editHistory.push(JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].stepOfHistory])));
        level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]][id] = document.getElementById(id).value;
        //  level[level.mode].stepOfHistory++;
        level[level.mode].stepOfHistory = level[level.mode].editHistory.length - 1;
        Layout();
      }
    }
    function courceSelectedEdit(value) {
      AblageListe[4] = true;
      if (offline == false) document.getElementById('preview').src = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/" + document.getElementById('modeSelection').value + "/GeduldsspielMap" + value.toString().split('.')[0] + ".png";
      else document.getElementById('preview').src = level[level.mode].mapsVorgefertigt[JSON.parse(value.toString().split('.')[0]) - 1];
      Layout();
      setTimeout(function() {
        Layout();
      }, 500);
    }
    // function changeAngle() {
    //   level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["angle"] = document.getElementById("angle").value;
    //   Layout();
    //   level[level.mode].editHistory.push(JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].editHistory.length - 1])));
    //
    // }
    // function changetimeFor360GradRotation() {
    //   level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] = document.getElementById("timeFor360GradRotation").value;
    //   Layout();
    //   level[level.mode].editHistory.push(JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].editHistory.length - 1])));
    // }
    // document.getElementById('image').width = window.innerWidth;
    // document.getElementById('image').height = AblageListe[5];
    visible([
      ['pictureSelection', "none"],
      ['app', "none"],
      // ['sliderSize', "none"],
      // ['sliderWidth', "none"],
      // ['sliderHeight', "none"],
      // ['angle', "none"]
      ['levelEditTool', "none"]
    ])
    // document.getElementById('colorPicker').value: fillStyle

    // document.getElementById('pictureSelection').style.display = "none";
    // document.getElementById('sliderSize').style.display = "none";
    // document.getElementById('sliderWidth').style.display = "none";
    // document.getElementById('sliderHeight').style.display = "none";
    // document.getElementById('angle').style.display = "none";

    var canvas = textur.getContext('2d'); //Dimension
    document.getElementById('textur').width = window.innerWidth - 20;
    document.getElementById('textur').height = window.innerHeight - 20;
    visible([
      ['timeFor360GradRotation', "none"],
      ['timeVisible', "none"],
      ['timeInvisible', "none"]
    ]);
    document.getElementById('timeFor360GradRotation').style.display = "none";
    console.log(window.innerWidth + " - " + window.innerHeight);
    var RotatingWall;
    var RotatingDreieck;
    var BlinkWall;
    var bulletInterval = [];
    var mins = 0;
    var secs = 0;
    var tenths = 0;
    var time = 0;
    var x1 = 10,
      y1 = 177; //window.innerHeight - 150 + 3,
    x2 = 0, y2 = 0,
      vx1 = 0, vy1 = 0,
      vx2 = 0, vy2 = 0,
      ax1 = 0, ay1 = 0;
    var mausx = 0;
    var mausy = 0;
    var zählerListe = [window.innerHeight];
    var offline = false;
    var Bild = new Image();
    var risingStrengthInterval;
    if (offline == false) Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/normal/GeduldsspielMap1.png"
    canvas.drawImage(Bild, 0, 0, window.innerWidth, window.innerHeight)
    setTimeout(function() {
      Layout();
    }, 500);
    sphere1.style.width = (window.innerWidth / 40 + 66) / 2 + "px";
    sphere1.style.height = (window.innerWidth / 40 + 66) / 2 + "px";
    var level = {
      normal: {
      rotating: {
        blinkWall: [false] /*, rotatingWall: false*/ ,
        rotatingDreieck: false
      },
      number: 1,
      vorgefertigt: {
        1: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        2: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          },
          blinkWall: [{
            timeInvisible: 3000,
            timeVisible: 3000,
            x: /*220*/ window.innerWidth / 7.25,
            y: /*177*/ window.innerHeight / 4.4,
            width: /*115*/ window.innerWidth / 14,
            height: 17
          }, {
            timeInvisible: 3000,
            timeVisible: 3000,
            x: /*220*/ window.innerWidth / 7.25,
            y: /*177*/ window.innerHeight / 2,
            width: /*115*/ window.innerWidth / 14,
            height: 17
          }]
        },
        3: {
          sensibility: 17,
          spawnPoint: {
            x: 10,
            y: 255
          },
          rotatingWall: [{
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 0
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 22
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 44
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 88
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 110
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 130
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 150
          }, {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 120,
            height: 17,
            angle: 70
          }]
        },
        5: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          },
          rotatingWall: [{
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            width: window.innerWidth - 200,
            height: 17,
            angle: 0
          }]
        },
        4: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          },
          rotatingDreieck: [{
            x: window.innerWidth / (1600 / 300),
            y: window.innerHeight / (769 / 155),
            size: window.innerWidth / (1600 / 37),
            timeFor360GradRotation: 1000,
            angle: 0
          }, {
            x: window.innerWidth / (1600 / 500),
            y: window.innerHeight / (769 / 444),
            size: (window.innerWidth + window.innerHeight) / ((1600 + 769) / 37),
            timeFor360GradRotation: 1000,
            angle: 10
          }, {
            x: window.innerWidth / (1600 / 733),
            y: window.innerHeight / (769 / 588),
            size: window.innerWidth / (1600 / 37),
            timeFor360GradRotation: 1000,
            angle: 0
          }, {
            x: window.innerWidth / (1600 / 1222),
            y: window.innerHeight / (769 / 377),
            size: window.innerWidth / (1600 / 96),
            timeFor360GradRotation: 777,
            angle: 0
          }]
        },
        6: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        7: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          },
          rotatingWall: [{
            x: window.innerWidth / 4.22,
            y: window.innerHeight / 5.85,
            width: window.innerWidth / 2.9,
            height: 17,
            angle: 0
          }, {
            x: window.innerWidth / 2.4,
            y: window.innerHeight / 1.9,
            width: window.innerWidth / 4,
            height: 17,
            angle: 0
          }, {
            x: window.innerWidth / 1.44,
            y: window.innerHeight / 1.77,
            width: window.innerWidth / 5,
            height: 17,
            angle: 0
          }, {
            x: window.innerWidth / 1.1,
            y: window.innerHeight / 1.8,
            width: window.innerWidth / 5,
            height: 17,
            angle: 0
          }]
        },
        8: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        9: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        10: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        11: {
          sensibility: 5,
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        12: {
          sensibility: 35,
          spawnPoint: {
            x: 10,
            y: 255
          },
          bullet: [
            {
              startPointInSec: 0,
              pxPerMiliSec: 33,
              startPosition: {
                x: window.innerWidth + 100,
                y: 77
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: "endless"},
              direction: "left",
              radius: 50
            }
          ]
        },
        13: {
          sensibility: 32,
          spawnPoint: {
            x: 10,
            y: 255
          },
          bullet: [
            {
              startPointInSec: 0,
              pxPerMiliSec: 30,
              startPosition: {
                x: -100,
                y: 77
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: "endless"},
              direction: "right",
              radius: 50
            },
            {
              startPointInSec: 1.3,
              pxPerMiliSec: 30,
              startPosition: {
                x: -100,
                y: 77
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: "endless"},
              direction: "right",
              radius: 50
            }
          ],
          blinkWall: [{
            beginningTime: 8,
            timeInvisible: 2000,
            timeVisible: 5666,
            x: /*220*/ window.innerWidth - 277,
            y: /*177*/ 10,
            width: /*115*/ 111,
            height: 133
          }],
        }
      },
      editLevel: {
        selectedLevel: 1
      },
      editHistory: [],
      stepOfHistory: -1,
      worldWideLevel: {},
      levelType: "vorgefertigt"
    },
    growing: {
      rotating: {
        blinkWall: [false] /*, rotatingWall: false*/ ,
        rotatingDreieck: false
      },
      number: 1,
      editLevel: {
        selectedLevel: 1
      },
      editHistory: [],
      stepOfHistory: -1,
      worldWideLevel: {},
      levelType: "vorgefertigt",
      vorgefertigt: {
        1: {
          sensibility: 5,
          pixelPer7MiliSecGrowing: 0.07,
          beginningSize: {
            x: (window.innerWidth / 40 + 333) / 2,
            y: (window.innerHeight / 40 + 333) / 2
          },
          spawnPoint: {
            x: window.innerWidth/2 - JSON.parse(sphere1.style.width.toString().split('px')[0]) + 33,
            y: window.innerHeight/2 - JSON.parse(sphere1.style.height.toString().split('px')[0])
          }
        },
        2: {
          sensibility: 5,
          pixelPer7MiliSecGrowing: 0.3,
          beginningSize: {
            x: (window.innerWidth / 40 + 66) / 2,
            y: (window.innerHeight / 40 + 66) / 2
          },
          spawnPoint: {
            x: 10,
            y: 255
          }
        },
        3: {
          sensibility: 5,
          pixelPer7MiliSecGrowing: 0.4,
          beginningSize: {
            x: (window.innerWidth / 40 + 66) / 2,
            y: (window.innerHeight / 40 + 66) / 2
          },
          spawnPoint: {
            x: 10,
            y: 255
          }
        }
      }
    },
    survive: {
      rotating: {
        blinkWall: [false] /*, rotatingWall: false*/ ,
        rotatingDreieck: false
      },
      number: 1,
      editLevel: {
        selectedLevel: 1
      },
      editHistory: [],
      stepOfHistory: -1,
      worldWideLevel: {},
      levelType: "vorgefertigt",
      vorgefertigt: {
        1: {
          sensibility: 25,
          spawnPoint: {
            x: window.innerWidth/2 - JSON.parse(sphere1.style.width.toString().split('px')[0]),
            y: window.innerHeight/2 - JSON.parse(sphere1.style.height.toString().split('px')[0])
          },
          bullet: [
            {
              startPointInSec: 0,
              pxPerMiliSec: 33,
              startPosition: {
                x: -90,
                y: window.innerHeight/2 - 50
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: 3, beginningtimes: [7, 7, 7]},
              direction: "right",
              radius: 50
            },
            {
              startPointInSec: 0,
              pxPerMiliSec: 33,
              startPosition: {
                x: -90,
                y: window.innerHeight/2 + 133
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: 3, beginningtimes: [7, 7, 7]},
              direction: "right",
              radius: 50
            },
            {
              startPointInSec: 27,
              pxPerMiliSec: 15,
              startPosition: {
                x: window.innerWidth/2 + 100,
                y: -90
              },
              // endPosition:
              repeatIntervalIn_Secs: 7,
              repetitions: {need: 2, beginningtimes: [0, 0]},
              direction: "down",
              radius: 77
            },
            {
              startPointInSec: 34,
              pxPerMiliSec: 20,
              startPosition: {
                x: window.innerWidth/2 -150,
                y: -90
              },
              // endPosition:
              repeatIntervalIn_Secs: 7, // not needed (?)
              repetitions: {need: 0, beginningtimes: []},
              direction: "down",
              radius: 77
            }
          ]
        },
        2: {
          sensibility: 25,
          spawnPoint: {
            x: window.innerWidth/2 - JSON.parse(sphere1.style.width.toString().split('px')[0]),
            y: window.innerHeight/2 - JSON.parse(sphere1.style.height.toString().split('px')[0])
          },
          pcStrength: 1,
          pxPcStrength: 1,
          risingPxStrength: true,
        }
      }
    },
      opposite: {
        rotating: {
          blinkWall: [false] /*, rotatingWall: false*/ ,
          rotatingDreieck: false
        },
        number: 1,
        editLevel: {
          selectedLevel: 1
        },
        editHistory: [],
        stepOfHistory: -1,
        worldWideLevel: {},
        levelType: "vorgefertigt"
      },

      againstThePC: {
        rotating: {
          blinkWall: [false] /*, rotatingWall: false*/ ,
          rotatingDreieck: false
        },
        number: 1,
        editLevel: {
          selectedLevel: 1
        },
        editHistory: [],
        stepOfHistory: -1,
        worldWideLevel: {},
        levelType: "vorgefertigt",
        vorgefertigt: {
          1: {
            sensibility: 25,
            pcStrength: 33,
            pxPcStrength: 1,
            spawnPoint: {
              x: 10,
              y: 222
            },
          },
          2: {
            sensibility: 25,
            pcStrength: 10,
            pxPcStrength: 1,
            spawnPoint: {
              x: 350,
              y: 622
            },
          },
          3: {
            sensibility: 25,
            pcStrength: 10,
            pxPcStrength: 1,
            spawnPoint: {
              x: 10,
              y: 422
            },
          },
          4: {
            sensibility: 25,
            pcStrength: 8,
            pxPcStrength: 1,
            spawnPoint: {
              x: 10,
              y: 422
            },
          },
          5: {
            sensibility: 10,
            pcStrength: 17,
            pxPcStrength: 1,
            spawnPoint: {
              x: 133,
              y: 350
            },
          }
        }
      },
      mode: "normal"
    }
    level.opposite.vorgefertigt = JSON.parse(JSON.stringify(level.normal.vorgefertigt));
    //window.innerHeight - 150 + 3//window.innerHeight/4//610;
    // for (var i = 0; zählerListe[0]>0;i++) {
    //   data = canvas.getImageData(10, zählerListe[0], 1, 1);
    //   red = data.data[0];
    //   green = data.data[1];
    //   blue = data.data[2];
    //   alpha = data.data[3];
    //   if (red == 0 && blue == 0 && alpha == 255 && green == 0) {
    //     y1 = zählerListe[0] - (window.innerWidth/40 + 66);
    //     spawnPoint = zählerListe[0] - (window.innerWidth/40 + 66)
    //   }
    //   zählerListe[0]--;
    // }
    var highscores = {}
    var highscoresDisplayedBefore = {};
    var AblageListe = [];
    AblageListe[5] = window.innerHeight;
    if (!localStorage.getItem("storedName")) {
      var name = prompt("Wie heißen sie? (Diese Info ist nötig, um ihre Highscores (Bestzeit) zu speichern! Ihre Zeiten werden auf Anfrage, oder beim Beenden aller Level angezeigt)");
    }
    else var name = localStorage.getItem("storedName");
    localStorage.setItem("storedName", name);
    nameEingeloggt.innerHTML = "als " + name + " eingeloggt"
    for (var i = 0; i < Object.keys(level).length - 1; i++) {
      highscores[Object.keys(level)[i]] = {};
      highscores[Object.keys(level)[i]][name] = [];
    }
    AblageListe[6] = false;
    function selected() {
      if (AblageListe[6] == true) {AblageListe[6] = false; document.getElementById('select').style.background = "";}
      else {AblageListe[6] = true; document.getElementById('select').style.background = "blue";}
    }
    dbGet("Gelduldspiel", "highscores").then(result => {
      folgenDbgetHighscores(/*JSON.parse(*/result/*)*/, false);
      app._data.db = [];
      if (localStorage.getItem("uploadScore") == true && localStorage.getItem("profileName") == name) {
        for (var i = 0; i < Object.keys(JSON.parse(localStorage.getItem("levelAroundTheWorld"))).length; i++) {
          level[level.mode].worldWideLevel[Object.keys(JSON.parse(localStorage.getItem("levelAroundTheWorld")))[i]].highscores[0][name] = localStorage.getItem("levelAroundTheWorld")[Object.keys(JSON.parse(localStorage.getItem("levelAroundTheWorld")))[i]];
        }
        localStorage.setItem("uploadScore", false);
      }
      if (localStorage.getItem("profileName") == name && localStorage.getItem("highscoresGeduldsspiel") != null && !(angular.equals(highscores[level.mode][name]), JSON.parse(localStorage.getItem("highscoresGeduldsspiel"))[name])) {
        highscores[level.mode][name] = JSON.parse(localStorage.getItem("highscoresGeduldsspiel"))[level.mode][name];
      }
    }).catch(function(e) {
      console.error(e);
      if (e == "TypeError: Failed to fetch") {
        alert("Offline Modus aktiviert! Da sie keine Internetverbindung haben, werden die zuletzt auf ihrem Gerät gespeicherten Daten verwendet, welche jedoch uventuell nicht aktuell sind. Wenn sie wieder Internet haben, werden die Daten synchronisiert!");
        offline = true;
        if (localStorage.getItem("profileName") == name && localStorage.getItem("mapsVorgefertigt") != null) level[level.mode].mapsVorgefertigt = JSON.parse(localStorage.getItem("mapsVorgefertigt"));
        else alert("please save the vorgefertigt maps on your device when you are online againt to be alble to play them offline!");
        document.getElementById('saveMaps').style.display = "none";
        window.innerWidth += 832;
        folgenDbgetHighscores(JSON.parse(localStorage.getItem("highscoresGeduldsspiel")), true);
      }
    });
    function folgenDbgetHighscores(result, offline) {
        highscores = result
        for (var i = 0;
  (i < highscores[level.mode][name].length + 1 && i <= Object.keys(level[level.mode].vorgefertigt).length - 1)/* || i < highscores[name].length*/; i++) {
  opt1 = document.createElement("option");
  document.getElementById("courceSelectionEdit").options.add(opt1);
  opt1.setAttribute("id", i);
  opt1.text = (i + 1) + ". map"
  AblageListe[0] = i;
}
        for (var i = 0; i < Object.keys(level).length - 1; i++) {
          if (highscores[Object.keys(level)[i]] == undefined) highscores[Object.keys(level)[i]] = {};
          if (highscores[Object.keys(level)[i]][name] == undefined) highscores[Object.keys(level)[i]][name] = [];
        }
        // for (var i = 0; i < result.length; i++) {
        //   highscores[Object.keys(result)[i]] = result[Object.keys(result)[i]];
        // }
      AblageListe[0] = 0;
      for (var i1 = 0; i1 < Object.keys(highscores).length; i1++) {
      highscores[Object.keys(highscores)[i1]].allMaps = [];
      for (var i = 0; i < Object.keys(level[level.mode].vorgefertigt).length; i++) {
        highscores[Object.keys(highscores)[i1]].allMaps.push("allMaps");
      }
    }
        if (highscores[level.mode][name] != undefined && highscores[level.mode][name].length > 0) {
          level.mode = "inProgress";
          modeSelected("normal");
      }
      else {
        visible([["modeSelection", "none"]]);
        highscores.normal[name] = [];
      }
      if (highscores[level.mode][name].length == 0) courceSelected();
      else document.getElementById('textur').style.display = "none";
      document.getElementById('courceSelection').value = "select map!";
      if (highscores[level.mode][name].length > 0 && offline == false) {
      dbGet("Gelduldspiel", "levelAroundTheWorld").then(result => {
        folgenDbGetLevelAroundTheWorld(result, false);
        app._data.db = [];
      }).catch(function(e) {
        console.error(e);
      });
      dbGet("Gelduldspiel", "levelBy " + name).then(result => {
        folgenDbGetLevelBy(result, false);
        app._data.db = [];
        if (localStorage.getItem("profileName") == name && JSON.parse(localStorage.getItem("uploadCources")) && JSON.parse(localStorage.getItem("uploadCources")).length > 0) {
          for (var i = 0; i < JSON.parse(localStorage.getItem("uploadCources")).length; i++) {
            level[level.mode].editLevel.selectedLevel = JSON.parse(localStorage.getItem("uploadCources"))[i];
            level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel] = level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel];
            level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel].playedBy = {};
            level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel].highscores = [{}];
          }
          localStorage.setItem("levelAroundTheWorld", JSON.stringify(level[level.mode].worldWideLevel))
          dbSet("Gelduldspiel", "levelAroundTheWorld", level[level.mode].worldWideLevel);
          localStorage.setItem("uploadCources", []);
        }
      }).catch(function(e) {
        console.error(e);
        app._data.db = [];
        app._data.db.push("create new level");
      });
    }
    else if (localStorage.getItem("profileName") == name && highscores[level.mode][name].length > 0) {
      folgenDbGetLevelBy(JSON.parse(localStorage.getItem("levelBy " + name)), true);
      folgenDbGetLevelAroundTheWorld(JSON.parse(localStorage.getItem("levelAroundTheWorld")), true);
    }
    }
    function folgenDbGetLevelAroundTheWorld(result, offline) {
      level[level.mode].worldWideLevel = result;
      app._data.db = Object.keys(result);
      setTimeout(function() {
        visible([
          ["app", "inline"],
          ['uploadLevel', "inline"],
          ['levelEditTool', "none"]
        ]);
        var items = document.querySelectorAll("#levelNames");
        var tab = [];
        var liIndex;
        for (i = 0; i < items.length; i++) {
          tab.push(items[i].innerHTML);
        }
        for (var i = 0; i < items.length; i++) {
          items[i].onclick = function() {
            liIndex = tab.indexOf(this.innerHTML);
            console.log(this.innerText + " INDEX = " + liIndex);
            level[level.mode].levelType = "worldWideLevel";
            level[level.mode].number = this.innerText;
            if (level[level.mode].worldWideLevel[level[level.mode].number].playedBy[name] == undefined)  level[level.mode].worldWideLevel[level[level.mode].number].playedBy[name] = {played: true, finished: false};
            document.getElementById('preview').src = level[level.mode][level[level.mode].levelType][level[level.mode].number].picture;
            sphere1.style.width = level[level.mode].worldWideLevel[level[level.mode].number].ballSize;
            sphere1.style.height = level[level.mode].worldWideLevel[level[level.mode].number].ballSize;
            Layout();
            visible([['preview', "none"], ['textur', "inline"]]);
            document.getElementById('preview').style.display = "none";
            window.scroll(0, 0);
            startPause();
            activateBlinkWall();
            sensibility(level[level.mode].worldWideLevel[level[level.mode].number].sensibility, false);
            if (level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall == undefined)) {
            RotatingWall = setInterval(function() {
              level[level.mode].rotating.rotatingWall = true;
              level[level.mode].rotatingNow = "rotatingWall";
              Layout();
              rotatingWall(true);
            }, 70);
          }
            if (level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined)) {
            RotatingDreieck = setInterval(function() {
              level[level.mode].rotating.rotatingDreieck = true;
              level[level.mode].rotatingNow = "rotatingDreieck";
              Layout();
              rotatingDreieck();
            }, 70);
          }
          };
        };
      }, 1);
        alert("you are now ready to play level from all around the world!");
      var notification = new Notification('level loaded!', {
        icon: 'https://adi.nicolaiweitkemper.de/Bilder/loadingIcon.png',
        body: "Your level are now ready to be edited, played or uploaded!",
      });
    }
    function folgenDbGetLevelBy(result, offline) {

      // if (Object.keys(level[level.mode].editLevel).length > 2) {
      //   AblageListe[0] = Object.keys(level[level.mode].editLevel);
      //   for (var i = 0; i < Object.keys(level[level.mode].editLevel).length; i++) {
      //     if (AblageListe[0][i] == "selectedLevel" || AblageListe[0][i] == "selected") {AblageListe[0].splice(i, 1); i = -1;}
      //   }
      //   app._data.db = AblageListe[0]
      //   app._data.db.push("create new level");
      // }
      // alert("loading your levels...");
      // visible([
      //   ['app', "inline"],
      //   ['preview', "none"]/*,
      //   ['levelEditTool', "inline"]*/
      // ]);
      //
      app._data.db = [];
      for (var i = 0; result != null && i < Object.keys(result).length; i++) {
        level[level.mode].editLevel[Object.keys(result)[i]] = result[Object.keys(result)[i]];
        if (Object.keys(result)[i] != "selectedLevel" && Object.keys(result)[i] != "selected") app._data.db.push(Object.keys(result)[i]);
      }
      app._data.db.push("create new level");
      setTimeout(function() {
        visible([
          ["app", "inline"]
        ]);
        var items = document.querySelectorAll("#levelNames");
        var tab = [];
        var liIndex;
        for (i = 0; i < items.length; i++) {
          tab.push(items[i].innerHTML);
        }
        for (var i = 0; i < items.length; i++) {
          items[i].onclick = function() {
            liIndex = tab.indexOf(this.innerHTML);
            console.log(this.innerText + " INDEX = " + liIndex);
            visible([
              ['pictureSelection', "inline"],
              ['textur', "inline"] /*, ['courceSelection', "none"]*/ ,
              ['preview', "none"],
              // ['blinkWall', "inline"],
              // ['rotatingWall', "inline"],
              // ["rotatingDreieck", "inline"],
              // ['testLevel', "inline"],
              // ["courceSelectionEdit", "inline"]
              ['levelEditTool', "inline"]
            ]);
            level[level.mode].editHistory = [];
            if (this.innerHTML.includes("create new level")) {
              createNewLevel();
              canvas.fillStyle = "white";
              canvas.fillRect(0, 0, window.innerWidth, AblageListe[5]);
              canvas.font = "50px Georgia";
              canvas.fillStyle = "black";
              canvas.fillText("Please select a background", window.innerWidth / 2 - 300, AblageListe[5] / 2 - 50);
            } else {
              document.getElementById('preview').src = level[level.mode].editLevel[this.innerText].picture; /*level[level.mode].number = this.innerText; */
              level[level.mode].number = 1;
              level[level.mode].editHistory.push(level[level.mode].editLevel[this.innerText]);
            //  level[level.mode].stepOfHistory = level[level.mode].editHistory.length - 1;
              level[level.mode].stepOfHistory = 1;
              level[level.mode].editHistory.unshift([]);
              level[level.mode].editLevel.selectedLevel = this.innerText;
              sphere1.style.width = level[level.mode].editHistory.ballSize + "px";
              sphere1.style.height = level[level.mode].editHistory.ballSize + "px";
              level[level.mode].editHistory.spawnPoint = level[level.mode].editHistory[1].spawnPoint;
              größeAnpassen();
              Layout();
              level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenXOriginal = innerWidth;
              level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenYOriginal = innerHeight;
              level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].sensibility = result[level[level.mode].editLevel.selectedLevel].sensibility;
              level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].spawnPoint = result[level[level.mode].editLevel.selectedLevel].spawnPoint;
              setTimeout(function() {
                Layout();
              }, 500);
            };
          };
        }
        Notification.requestPermission();
          alert("you are now ready to open your level!");
        var notification = new Notification('level loaded!', {
          icon: 'https://adi.nicolaiweitkemper.de/Bilder/loadingIcon.png',
          body: "Your level are now ready to be edited, played or uploaded!",
        });
      }, 1);
    }
    var app = new Vue({
      el: '#app',
      data: {
        db: []
      }
    })
    function createNewLevel() {
      AblageListe[0] = prompt("Wie wollen sie das Level nennen?");
      if (Object.keys(level[level.mode].editLevel).includes(AblageListe[0]) || AblageListe[0] == "Test") {
        alert("Name bereits vorhanden! Bitte anderen Namen eingeben!");
        createNewLevel();
      } else {
        level[level.mode].editLevel.selectedLevel = AblageListe[0];
        level[level.mode].number = AblageListe[0];
        level[level.mode].editHistory.ballSize = 50;
        level[level.mode].editHistory.spawnPoint = {
          x: 10,
          y: 255
        };
        if (level.mode == "growing") {
          level.growing.editHistory.pixelPer7MiliSecGrowing = 0.07;
          level.growing.editHistory.beginningSize = {x: level[level.mode].editHistory.ballSize, y: level[level.mode].editHistory.ballSize};
        }
      }
    }


    function uploadLevel() {
      if (level.mode == "normal" || level.mode == "opposite") alert("You have to beat your level, before you can upload it!");
      else if (level.mode == "growing") alert("you have to stay alive for at least 5 sec, to be able to uplad it!");
      else if (level.mode == "survive") alert("you have to stay alive for at least 10 sec, to be able to upload it!");
      AblageListe[1] = "uploadLevel";
      testLevel();
    }
    var againstThePCDirection = ["x", 0];
    function againstThePCFunction() {
      // if (Math.round(Math.random()*75) < 50) {
        if (/*Math.round(Math.random()*100) < 50*/againstThePCDirection[0] == "x") x1 += level[level.mode][level[level.mode].levelType][level[level.mode].number].pxPcStrength;
        else y1 += level[level.mode][level[level.mode].levelType][level[level.mode].number].pxPcStrength;
      // }
      againstThePCDirection[1]++;
      var directions = ["x", "y"]
      if (againstThePCDirection[1] > 50)  againstThePCDirection = [directions[Math.round(Math.random()*1)], 0];
    }
    var againstThePCInterval;
    function courceSelected(ownSelection) {
      setTimeout(function () {
        window.scroll(0, 0);
      }, 777);
      level[level.mode].rotating.blinkWall = [false];
      level[level.mode].rotating.rotatingDreieck = false;
      level[level.mode].rotating.rotatingWall = false;
      if (running == 1) startPause();
      if (!(document.getElementById('courceSelection').value == "winner screen" || document.getElementById('courceSelection').value == "show scores" || document.getElementById('courceSelection').value == "upload own level" || document.getElementById('courceSelection').value == "play from world wide web")) startPause();
      if (document.getElementById('courceSelection').value != "vorgefertigt") app._data.db = [];
      /*if (document.getElementById('modeSelection').value == "survive") */
      if (document.getElementById('courceSelection').value != "winner screen") sphere1.style.backgroundColor = "blue";
      if (document.getElementById('courceSelection').value == "winner screen")  {Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gewinnerbildschirm.jpeg"; level[level.mode].levelType = "winnerScreen";
      setTimeout(function () {
        document.getElementById('textur').style.display = "inline";
        Layout();
      }, 500);
    }
    else if (document.getElementById('courceSelection').value == "show scores") {showScores(highscores[level.mode]);document.getElementById('levelEditTool').style.display = "none";level[level.mode].levelType = "showScores";        clearInterval(BlinkWall);
      clearInterval(RotatingWall);
      clearInterval(RotatingDreieck);}
      else if (document.getElementById('courceSelection').value == "upload own level") {
        folgenDbGetLevelBy(level[level.mode].editLevel, offline);
        // setTimeout(function () {
        //   var items = document.querySelectorAll("#levelNames");
        //   var tab = [];
        //   var liIndex;
        //   for (i = 0; i < items.length; i++) {
        //     tab.push(items[i].innerHTML);
        //   }
        //   for (var i = 0; i < items.length; i++) {
        //     items[i].onclick = function() {
        //       liIndex = tab.indexOf(this.innerHTML);
        //       console.log(this.innerText + " INDEX = " + liIndex);
        //       level[level.mode].blinkWall = false;
        //       visible([
        //         ['pictureSelection', "inline"],
        //         ['textur', "inline"] /*, ['courceSelection', "none"]*/ ,
        //         ['preview', "none"],
        //         // ['blinkWall', "inline"],
        //         // ['rotatingWall', "inline"],
        //         // ["rotatingDreieck", "inline"],
        //         // ['testLevel', "inline"],
        //         // ["courceSelectionEdit", "inline"]
        //         ['levelEditTool', "inline"]
        //       ]);
        //       if (this.innerHTML.includes("create new level")) {
        //         createNewLevel();
        //         canvas.fillStyle = "white";
        //         canvas.fillRect(0, 0, window.innerWidth, AblageListe[5]);
        //         canvas.font = "50px Georgia";
        //         canvas.fillStyle = "black";
        //         canvas.fillText("Please select a background", window.innerWidth / 2 - 300, AblageListe[5] / 2 - 50);
        //       } else {
        //         document.getElementById('preview').src = level[level.mode].editLevel[this.innerText].picture; /*level[level.mode].number = this.innerText; */
        //         level[level.mode].editHistory.push(level[level.mode].editLevel[this.innerText]);
        //         level[level.mode].stepOfHistory = level[level.mode].editHistory.length - 1;
        //         level[level.mode].editLevel.selectedLevel = this.innerText;
        //         größeAnpassen();
        //         Layout();
        //         level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenXOriginal = innerWidth;
        //         level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenYOriginal = innerHeight;
        //         level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].sensibility = result[level[level.mode].editLevel.selectedLevel].sensibility;
        //         level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].spawnPoint = result[level[level.mode].editLevel.selectedLevel].spawnPoint;
        //         setTimeout(function() {
        //           Layout();
        //         }, 500);
        //       };
        //     };
        //   }
        // }, 1000);
        // if (Object.keys(level[level.mode].editLevel).length > 2) {
        //   AblageListe[0] = Object.keys(level[level.mode].editLevel);
        //   for (var i = 0; i < Object.keys(level[level.mode].editLevel).length; i++) {
        //     if (AblageListe[0][i] == "selectedLevel" || AblageListe[0][i] == "selected") {AblageListe[0].splice(i, 1); i = -1;}
        //   }
        //   app._data.db = AblageListe[0]
        //   app._data.db.push("create new level");
        // }
        // alert("loading your levels...");
        // visible([
        //   ['app', "inline"],
        //   ['preview', "none"]/*,
        //   ['levelEditTool', "inline"]*/
        // ]);
        level[level.mode].number = level[level.mode].editHistory.length - 1;
        // document.getElementById('pictureSelection').style.display = "inline";
        // document.getElementById('courceSelection').style.display = "none";
        // document.getElementById('preview').style.display = "none";
        // document.getElementById('blinkWall').style.display = "inline";
        // document.getElementById('rotatingWall').style.display = "inline";
        // document.getElementById('rotatingDreieck').style.display = "inline";
        level[level.mode].levelType = "editHistory";

        clearInterval(BlinkWall);
        clearInterval(RotatingWall);
        clearInterval(RotatingDreieck);
        level[level.mode].number = 1;
      } else if (document.getElementById('courceSelection').value == "play from world wide web") {
        level[level.mode].levelType = "worldWideLevel";
        folgenDbGetLevelAroundTheWorld(level[level.mode].worldWideLevel, offline);
        // setTimeout(function () {
        //   var items = document.querySelectorAll("#levelNames");
        //   var tab = [];
        //   var liIndex;
        //   for (i = 0; i < items.length; i++) {
        //     tab.push(items[i].innerHTML);
        //   }
        //   for (var i = 0; i < items.length; i++) {
        //     items[i].onclick = function() {
        //       liIndex = tab.indexOf(this.innerHTML);
        //       console.log(this.innerText + " INDEX = " + liIndex);
        //       level[level.mode].blinkWall = false;
        //       level[level.mode].levelType = "worldWideLevel";
        //       level[level.mode].number = this.innerText;
        //       document.getElementById('preview').src = level[level.mode][level[level.mode].levelType][level[level.mode].number].picture;
        //       Layout();
        //       visible([['preview', "none"], ['textur', "inline"]]);
        //       document.getElementById('preview').style.display = "none";
        //       window.scroll(0, 0);
        //       startPause();
        //       activateBlinkWall();
        //     };
        //   };
        // }, 1000);
        visible([
          ["app", "inline"],
          ['uploadLevel', "inline"],
          ['levelEditTool', "none"]
        ]);
        if (Object.keys(level[level.mode].worldWideLevel).length > 0) app._data.db = Object.keys(level[level.mode].worldWideLevel);
        clearInterval(RotatingWall);
        clearInterval(RotatingDreieck);
        clearInterval(BlinkWall);
      } else {
        clearInterval(RotatingWall);
        clearInterval(RotatingDreieck);
        clearInterval(BlinkWall);
        document.getElementById('levelEditTool').style.display = "none";
        level[level.mode].levelType = "vorgefertigt";
      //  if (highscores[level.mode][name] != undefined && highscores[level.mode][name].length > 0 && document.getElementById('courceSelection').value == "") level[level.mode].number++;
        if (document.getElementById('courceSelection').value != "") level[level.mode].number = JSON.parse(document.getElementById('courceSelection').value.toString().split('.')[0]);
        else if (level[level.mode].number > Object.keys(level[level.mode].vorgefertigt).length) {
          alert("every vorgefertigt level finished! That was the last one :(  )");
          Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gewinnerbildschirm.jpeg";
        }
        activateBullets();

        document.getElementById('textur').style.display = "inline";
        Layout();
        setTimeout(function() {
          Layout();
        }, 500);
      //  startPause();
        window.scroll(0, 0)
      //  BlinkWall = setInterval(blinkWall, 6000);
      // BlinkWall = setInterval(function() {
      //   for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall != undefined && i <  level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length; i++) {
      //     level[level.mode].rotating.blinkWall[i] = false;
      //   }
      //   setTimeout(function() {
      //     for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall != undefined &&  i < level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length; i++) {
      //       level[level.mode].rotating.blinkWall[i] = true;
      //     }
      //     level[level.mode].rotatingNow = "blinkWall";
      //     Layout();
      //   }, 3000);
      //   Layout();
      // }, 6000);
      activateBlinkWall();
      if (level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall == undefined)) {
      RotatingWall = setInterval(function() {
        level[level.mode].rotating.rotatingWall = true;
        level[level.mode].rotatingNow = "rotatingWall";
        Layout();
        rotatingWall(true);
      }, 70);
    }
      if (level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined)) {
      RotatingDreieck = setInterval(function() {
        level[level.mode].rotating.rotatingDreieck = true;
        level[level.mode].rotatingNow = "rotatingDreieck";
        Layout();
        rotatingDreieck();
      }, 70);
    }
      }
      if (level[level.mode].levelType != "vorgefertigt") document.getElementById('textur').style.display = "none";
      if (level[level.mode].levelType != "showScores") document.getElementById('scores').style.display = "none";
      else document.getElementById('scores').style.display = "inline";
      if (level.type != "showScores" && level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined) {
        x1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.x));
        y1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.y));
    }
    if (level[level.mode].levelType == "vorgefertigt") {
      if (level[level.mode][level[level.mode].levelType][level[level.mode].number/* - 1*/] != undefined) Bild = new Image();
      else  level[level.mode].levelType = "winnerScreen";
      if (offline == false && level[level.mode][level[level.mode].levelType][level[level.mode].number/* - 1*/] != undefined)  Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/" + level.mode + "/GeduldsspielMap" + level[level.mode].number + ".png"
      else if (level[level.mode][level[level.mode].levelType][level[level.mode].number/* - 1*/] != undefined) Bild.src = level[level.mode].mapsVorgefertigt[level[level.mode].number - 1];
    }

        if (level[level.mode].number > 1 &&(document.getElementById('sensibility').value != level[level.mode][level[level.mode].levelType][level[level.mode].number - 1].sensibility) && !(level[level.mode].number == highscores[level.mode][name].length + 1) && ownSelection != true) sensibility(/*level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility*/document.getElementById('sensibility').value);
        else if (level[level.mode][level[level.mode].levelType][level[level.mode].number/* - 1*/] != undefined && (ownSelection || document.getElementById('sensibility').value != level[level.mode][level[level.mode].levelType][level[level.mode].number/* - 1*/].sensibility) && !(level[level.mode].number == highscores[level.mode][name].length + 2))  sensibility(level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility, true);
        clearInterval(againstThePCInterval);
        if (document.getElementById('courceSelection').value != "" && (document.getElementById('modeSelection').value == "againstThePC" || level[level.mode][level[level.mode].levelType][level[level.mode].number].pcStrength != undefined)) againstThePCInterval = setInterval(againstThePCFunction, level[level.mode][level[level.mode].levelType][level[level.mode].number].pcStrength);
        clearInterval(risingStrengthInterval);
        if (document.getElementById('courceSelection').value != "" && level[level.mode][level[level.mode].levelType][level[level.mode].number].risingPxStrength == true) risingStrengthInterval = setInterval(risingStrengthFunction, 1000);
    }
    function risingStrengthFunction() {
      level[level.mode][level[level.mode].levelType][level[level.mode].number].pxPcStrength += 0.01;
    }
    function imageLoaded(input) {
      AblageListe[4] = false;
      var reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('preview').setAttribute("src", e.target.result)
      };
      reader.readAsDataURL(input.files[0])
      setTimeout(function() {
        canvas.drawImage(document.getElementById('preview'), 0, 0, window.innerWidth, AblageListe[5]);
        document.getElementById('textur').style.display = "inline";
      }, 500);
    }
    if (window.DeviceMotionEvent != undefined) {
      window.ondevicemotion = function(e) {
        ax1 = inOrAgainstDirection*event.accelerationIncludingGravity.x * 5;
        ay1 = inOrAgainstDirection*event.accelerationIncludingGravity.y * 5;
      }
      setInterval(function() {
        var landscapeOrientation = window.innerWidth / AblageListe[5] > 1;
        if (landscapeOrientation) {
          vx1 = vx1 + ay1;
          vy1 = vy1 + ax1;
          vx2 = vx2 + ay1;
          vy2 = vy2 + ax1;
        } else {
          vy1 = vy1 - ay1;
          vx1 = vx1 + ax1;
          vy2 = vy2 - ay1;
          vx2 = vx2 + ax1;
        }
        vx1 = vx1 * 0.98;
        vy1 = vy1 * 0.98;
        y1 = parseInt(y1 + vy1 / 50);
        x1 = parseInt(x1 + vx1 / 50);

        vx2 = vx2 * 0.98;
        vy2 = vy2 * 0.98;
        y2 = parseInt(y2 + vy2 / 30);
        x2 = parseInt(x2 + vx2 / 30);
        //  if (scrollY > 0) document.getElementById('sphere1').style.display = "none";
        boundingBoxCheck();
        sphere1.style.top = y1 + "px";
        sphere1.style.left = x1 + "px";
        if (( /*y1 <= AblageListe[5]*/ (scrollY == 0 && window.innerHeight == AblageListe[5]) || level[level.mode].levelType == "winnerScreen") && level[level.mode].levelType != "editHistory") sphere1.style.display = "inline";
        else sphere1.style.display = "none";
        var numbers = [
          [x1 + JSON.parse(sphere1.style.width.replace("px", "")) - 7, y1 + JSON.parse(sphere1.style.height.replace("px", "")) / 2],
          [x1 + JSON.parse(sphere1.style.width.replace("px", "")) / 2, y1 - 8],
          [x1 + JSON.parse(sphere1.style.width.replace("px", "")) / 2, y1 + JSON.parse(sphere1.style.height.replace("px", "")) - 7],
          [x1 - 10, y1 + JSON.parse(sphere1.style.height.replace("px", "")) / 2]
        ]
        for (var i = 0; (document.getElementById('courceSelection').value != "" || highscores[level.mode][name] == undefined) && i < 4; i++) {
          // canvas.fillStyle = "red";
          // canvas.fillRect(numbers[i][0] - 10, numbers[i][1] - 10, 10, 10);
          data = canvas.getImageData(numbers[i][0], numbers[i][1], 1, 1);
          red = data.data[0];
          green = data.data[1];
          blue = data.data[2];
          alpha = data.data[3];
          if (red == 0 && blue == 0 && alpha == 255 && green == 0) {
            console.log("Fail!");
            if (document.getElementById('courceSelection').value != "" && level[level.mode][level[level.mode].levelType][level[level.mode].number].risingPxStrength == true) level[level.mode][level[level.mode].levelType][level[level.mode].number].pxPcStrength = 1;
            if (level.mode == "survive") {
              if ((mins + ":" + secs + ":" + "0" + tenths) > "00:09:09" && AblageListe[1] == "uploadLevel") uploadLevel();
              else if (AblageListe[1] != "uploadLevel" && level.survive.levelType != "editLevel" && level.survive.levelType != "editHistory" && level.survive.levelType != "showScores") {
                if (level.survive.levelType == "worldWideLevel") {
                level[level.mode].worldWideLevel[level[level.mode].number].playedBy[name].finished = true;
                if (level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] == undefined) level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] = [mins + ":" + secs + ":" + "0" + tenths];
                else if (mins + ":" + secs + ":" + "0" + tenths < level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name][0]) level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] = [mins + ":" + secs + ":" + "0" + tenths];
              }
              if (level[level.mode].levelType == "vorgefertigt") {
                if (highscores[level.mode][name] == undefined || highscores[level.mode][name][level[level.mode].number] == undefined || highscores[level.mode][name][level[level.mode].number] < mins + ":" + secs + ":" + "0" + tenths) {
                  highscores[level.mode][name][level[level.mode].number] = mins + ":" + secs + ":" + "0" + tenths;
                  // localStorage.setItem("highscoresGeduldsspiel", JSON.stringify(highscores));
                  if (offline == false) dbSet("Gelduldspiel", "highscores", highscores);
                }
              }
              }
            }
            if (level.mode == "growing") {
              if ((mins + ":" + secs + ":" + "0" + tenths) > "00:04:09" && AblageListe[1] == "uploadLevel") uploadLevel();
              if (sphere1.style.display == "inline") modeSelected("growing");
              //startPause();
            }
            x1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.x));
            y1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.y)); //AblageListe[5] - 150 + 3;
            // x1 = 940;
            // y1 = 155;
            time = 0;
          }
          if (red == 255 && blue == 0 && alpha == 255 && green == 242 && level[level.mode].levelType != "editHistory") zielErreicht();
        }
      }, 25);
    }

    function testLevel() {
      if (document.getElementById('testLevel').innerHTML == "test Level") {
        level[level.mode].editLevel["Test"] = level[level.mode].editHistory[level[level.mode].stepOfHistory];
        if (level[level.mode].editHistory.spawnPoint != undefined) level[level.mode].editLevel.Test.spawnPoint = level[level.mode].editHistory.spawnPoint;
        if (level.mode == "growing")   {level[level.mode].editLevel.Test.beginningSize = level[level.mode].editHistory.beginningSize; level[level.mode].editLevel.Test.pixelPer7MiliSecGrowing = level[level.mode].editHistory.pixelPer7MiliSecGrowing;}
          sphere1.style.width = level[level.mode].editHistory.ballSize + "px";
          sphere1.style.height = level[level.mode].editHistory.ballSize + "px";
        level[level.mode].levelType = "editLevel";
        level[level.mode].number = "Test";
        if (!(level[level.mode].editLevel["Test"].rotatingWall == undefined) && level[level.mode].editLevel["Test"].rotatingWall.length > 0) {
        AblageListe[8] = JSON.parse(JSON.stringify(level[level.mode].editLevel["Test"].rotatingWall));
        RotatingWall = setInterval(function() {
          level[level.mode].rotating.rotatingWall = true;
          level[level.mode].rotatingNow = "rotatingWall";
          Layout();
        }, 40);
      }
      if (!(level[level.mode].editLevel["Test"].rotatingDreieck == undefined) && level[level.mode].editLevel["Test"].rotatingDreieck.length > 0) {
        RotatingDreieck = setInterval(function() {
          level[level.mode].rotating.rotatingDreieck = true;
          level[level.mode].rotatingNow = "rotatingDreieck";
          Layout();
        }, 40);
      }
        activateBlinkWall();
        document.getElementById('testLevel').innerHTML = "stop Test";

        visible([
          ['sliderSize', "none"],
          ['sliderWidth', "none"],
          ['sliderHeight', "none"],
          ['angle', "none"],
          ["rotatingWall", "none"],
          ["rotatingDreieck", "none"],
          ["blinkWall", "none"],
          ["timeVisible", "none"],
          ['timeInvisible', "none"]
        //  ['levelEditTool', "none"]
        ]);
        startPause();
      } else {
        startPause();
        //  level[level.mode][level[level.mode].levelType] = JSON.parse(JSON.stringify(AblageListe[1]));
        level[level.mode].number = 0;
        document.getElementById('testLevel').innerHTML = "test Level";
        //clearInterval(BlinkWall);
        clearInterval(RotatingWall);
        clearInterval(RotatingDreieck);
        for (var i = 0; !(level[level.mode].editHistory[level[level.mode].stepOfHistory].rotatingWall == undefined) && i < AblageListe[8].length; i++) {
          level[level.mode].editHistory[level[level.mode].stepOfHistory].rotatingWall[i].angle = AblageListe[8][i].angle;
        }
        level[level.mode].levelType = "editHistory";
        Layout();
        visible([
          ['angle', "inline"],
          ['blinkWall', "inline"],
          ['rotatingWall', "inline"],
          ['rotatingDreieck', "inline"]
        //  ['levelEditTool', "inline"]
        ]);
        document.getElementById('angle').style.display = "inline";
        visibilityEditStuff();
      }
    }

    function visibilityEditStuff() {
      if (level[level.mode].editLevel.selected[0] == "blinkWall") {
        visible([
          ['timeVisible', "inline"],
          ['timeInvisible', "inline"],
          ['angle', "none"]
        ]);

      } else visible([
        ['timeVisible', "none"],
        ['timeInvisible', "none"],
        ['angle', "inline"]
      ]);
      if (!(level[level.mode].editLevel.selected[0] == "rotatingDreieck")) {
        visible([
          ['sliderSize', "none"],
          ['timeFor360GradRotation', "none"],
          ['sliderWidth', "inline"],
          ['sliderHeight', "inline"]
        ])
      } else {
        visible([
          ["sliderSize", "inline"],
          ['sliderWidth', "none"],
          ['sliderHeight', "none"],
          ['timeFor360GradRotation', "inline"]
        ]);
      }
    }

    function blinkWall() {
      // if (!(level[level.mode].levelType == "editHistory")) {
      //Layout();
      //  setTimeout(function () {
      for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall == undefined) && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length; i++) {
        if (i == level[level.mode].editLevel.selected[1] && level[level.mode].levelType == "editHistory" && level[level.mode].editLevel.selected[0] == "blinkWall") canvas.fillStyle = "blue";
        else canvas.fillStyle = "black";
        if (level[level.mode].levelType == "editHistory" || (level[level.mode].rotating.blinkWall[i] == true/* && (level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "worldWideLevel")*/)) canvas.fillRect(level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].x, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].y, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].width, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].height);
      }
      //  }, 3000);
      // }
      // else {
      //   for (var i = 0; !(level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall == undefined) && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length; i++) {
      //     canvas.fillRect(level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].x, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].y, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].width, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].height);
      //   }
      //}
    }

    function zielErreicht() {
      if ((document.getElementById('sensibility').value == level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility) || (level[level.mode][level[level.mode].levelType][level[level.mode].number].sensibility == undefined && level[level.mode].levelType == "editLevel")) {
      if (level[level.mode].levelType == "worldWideLevel") {
        level[level.mode].worldWideLevel[level[level.mode].number].playedBy[name].finished = true;
        if (level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] == undefined) level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] = [mins + ":" + secs + ":" + "0" + tenths];
        else if (mins + ":" + secs + ":" + "0" + tenths < level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name][0]) level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][name] = [mins + ":" + secs + ":" + "0" + tenths];
        showScores(level[level.mode].worldWideLevel[level[level.mode].number].highscores[0]);
      }
      if (level[level.mode].levelType == "vorgefertigt") {
        if (highscores[level.mode][name] == undefined || highscores[level.mode][name][level[level.mode].number] == undefined || highscores[level.mode][name][level[level.mode].number] > mins + ":" + secs + ":" + "0" + tenths) {
          highscores[level.mode][name][level[level.mode].number] = mins + ":" + secs + ":" + "0" + tenths;
          // localStorage.setItem("highscoresGeduldsspiel", JSON.stringify(highscores));
          if (offline == false) dbSet("Gelduldspiel", "highscores", highscores);
        }
        level[level.mode].number++;
        document.getElementById('courceSelection').value = level[level.mode].number + ". map";
        courceSelected();
        if (level[level.mode].vorgefertigt[level[level.mode].number] == undefined) {
          console.log("everything Finished!");
          clearInterval(BlinkWall);
          clearInterval(RotatingWall);
          clearInterval(RotatingDreieck);
          showScores(highscores[level.mode]);
        }
      }
      if (level[level.mode].levelType == "editLevel" && !(AblageListe[1] == "uploadLevel") && confirm("you have to clear your level, to upload it, so this is the best chance, if you have finished!")) AblageListe[1] = "uploadLevel";
      if (level[level.mode].levelType == "editLevel" && AblageListe[1] == "uploadLevel") {
        uploadLevel();
      }
    }
    else if (level[level.mode].number == highscores[level.mode][name].length) {
      alert("gg! Now, try it at normal speed to receve an highscore and maybe even unlock new level)");
    }
    else {
    //  alert("WARNING: The sensibility isn't normal, so you won't get any score for that!");
      level[level.mode].number++;
      document.getElementById('courceSelection').value = level[level.mode].number + ". map";
      courceSelected();
      if (level[level.mode].vorgefertigt[level[level.mode].number] == undefined) {
        console.log("everything Finished!");
        clearInterval(BlinkWall);
        clearInterval(RotatingWall);
        clearInterval(RotatingDreieck);
        showScores(highscores[level.mode]);
      }
    }
    if (level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined) {
      x1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.x));
      y1 = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType][level[level.mode].number].spawnPoint.y));
  }
  }
  function uploadLevel() {
    AblageListe[1] = "beendet";
    level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].ballSize = level[level.mode].editHistory.ballSize;
    if (level.mode == "growing")   level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].beginningSize = level[level.mode].editHistory.beginningSize;
    level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel] = level[level.mode].editLevel.Test//[level[level.mode].editLevel.selectedLevel];
    level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel].playedBy = {};
    level[level.mode].worldWideLevel[level[level.mode].editLevel.selectedLevel].highscores = [{}];
    // localStorage.setItem("levelAroundTheWorld", JSON.stringify(level[level.mode].worldWideLevel))
    if (offline == false) {
    dbSet("Gelduldspiel", "levelAroundTheWorld", level[level.mode].worldWideLevel);
    alert("uploading...");
    var checkLevelUploaded = setInterval(function() {
      dbGet("Gelduldspiel", "levelAroundTheWorld").then(result => {
        if (angular.equals(Object.keys(level[level.mode].worldWideLevel), Object.keys(result))) {
          alert("level uploaded!");
          clearInterval(checkLevelUploaded);
        }
      }).catch(function(e) {
        console.error(e);
      });
    }, 1000);
  }
  else if (localStorage.getItem("profileName") == name) {
    alert("level will be uploaded, when you have internet again and open this site");
    AblageListe[0] = JSON.parse(localStorage.getItem("oploadCources"));
    AblageListe[0].push();
    localStorage.setItem("oploadCources", level[level.mode].editLevel.selectedLevel);
  }
  }
    function showScores(highscores) {
      for (var i = 0; i < Object.keys(highscoresDisplayedBefore).length + 11 && Object.keys(highscoresDisplayedBefore).length > 0; i++) {
        try {
          document.getElementById("scores").deleteRow(0);
        } catch (e) {
          console.log("wanted to delete too many elements of table");
          i = Object.keys(highscoresDisplayedBefore).length + 11
        }
      }
      highscoresDisplayedBefore = highscores;
      document.getElementById('textur').style.display = "none";
      console.log("scores: " + highscores);
      var cell = [ /*row.insertCell(0)*/ ];
      for (var i = 0; i < Object.keys(highscores).length; i++) {
        if (!(Object.keys(highscores)[i] == "allMaps")) {
          var table = document.getElementById("scores");
          var row = table.insertRow(i);
          cell.push(row.insertCell(0));
          cell[cell.length - 1].innerHTML = Object.keys(highscores)[i];
        }
        //  var cell = [/*row.insertCell(0)*/];
        for (var i1 = 1; (i1 < Object.keys(level[level.mode][level[level.mode].levelType]).length + 1 && level[level.mode].levelType == "vorgefertigt") || (i1 < Object.keys(highscores).length && level[level.mode].levelType == "worldWideLevel"); i1++) {
          if (!(Object.keys(highscores)[i] == "allMaps")) {
            if (i1 < highscores[Object.keys(highscores)[i]].length + 1) {
              cell[cell.length - 2] = row.insertCell(i1);
              if (level[level.mode].levelType == "worldWideLevel" && i1 == 0) {
                i1--;
              }
              cell[cell.length - 2].innerHTML = highscores[Object.keys(highscores)[i]][i1/* - 1*/];
              if (highscores[Object.keys(highscores)[i]][i1/* - 1*/] > highscores[name][i1/* - 1*/]) cell[cell.length - 2].style.color = "red";
              else if (highscores[Object.keys(highscores)[i]][i1/* - 1*/] < highscores[name][i1/* - 1*/]) cell[cell.length - 2].style.color = "green";
              else if (name == Object.keys(highscores)[i]) cell[cell.length - 2].style.color = "blue";
              else cell[cell.length - 2].style.color = "black";

            } else {
              cell[cell.length - 2] = row.insertCell(i1);
              //  cell[cell.length - 2].innerHTML = "unmade";
              //  cell[cell.length - 2].style.color = "black";
            }
          }
        }
        var row = table.insertRow(i);
        if (i == 0) {}
        //  var row = table.insertRow(i+1);
        // var row = table.insertRow(i + 1);
      }
      //  var row = table.insertRow(0);
      //  var cell = [/*row.insertCell(0)*/];
      // cell.push(row.insertCell(0));
      // cell[cell.length - 1].innerHTML = "name";
      var row = table.insertRow(0);
      cell.push(row.insertCell(0));
      cell[cell.length - 1].innerHTML = "name";
      if (level[level.mode].levelType == "worldWideLevel") {
        cell.push(row.insertCell(i1 - 3));
        cell[cell.length - 1].innerHTML = "times";
      }
      for (var i1 = 1; level[level.mode].levelType != "worldWideLevel" && i1 < Object.keys(level[level.mode][level[level.mode].levelType]).length + 1; i1++) {
        cell.push(row.insertCell(i1));
        cell[cell.length - 1].innerHTML = (i1) + ". Map";
      }
      if (level[level.mode].levelType == "worldWideLevel") {
        // localStorage.setItem("levelAroundTheWorld", JSON.stringify(level[level.mode].worldWideLevel));
        if (offline == false) {
      dbSet("Gelduldspiel", "levelAroundTheWorld", level[level.mode].worldWideLevel);
      alert("uploading (high)score...");
      var checkLevelUploadedHighscore = setInterval(function() {
        dbGet("Gelduldspiel", "levelAroundTheWorld").then(result => {
          if (angular.equals(Object.keys(level[level.mode].worldWideLevel), Object.keys(result))) {
            AblageListe[0] = 0;
            for (var i = 0; i < Object.keys(level[level.mode].worldWideLevel).length; i++) {
              if (angular.equals(level[level.mode].worldWideLevel[level[level.mode].number].highscores[0][Object.keys(level[level.mode].worldWideLevel[level[level.mode].number].highscores[0])[i]], result[level[level.mode].number].highscores[0][Object.keys(result[level[level.mode].number].highscores[0])[i]])) AblageListe[0]++;
            }
            if (AblageListe[0] == Object.keys(result).length) {
            alert("(high)score uploaded!");
            clearInterval(checkLevelUploadedHighscore);
          }
          }
        }).catch(function(e) {
          console.error(e);
        });
      }, 5000);
    }
    else {
      alert("your score will be uploaded when you are online again!");
      localStorage.setItem("uploadScore", true);
    }
    }
    }
    // Für rotatingDreieck:
    const point = (x, y) => ({
      x,
      y
    });
    const triangle = createPath(point(0, -25), point(-50, -75), point(-100, -25));
    var rectangle = createPath(point(0,-25), point(-50,-25), point(-50,-125), point(0,-125));
    // function drawPath(path, x, y, angle) {
    //     canvas.setTransform(1, 0, 0, 1, x, y);
    //     canvas.rotate(level[level.mode].vorgefertigt[level[level.mode].number].rotatingDreieck[i].angle);
    //     canvas.stroke(path);
    // }

    function drawPath_V2(path, x, y, scale, angle, strokeStyle, fillStyle, i) {
      canvas.setTransform(scale, 0, 0, scale, x, y);
      if (level[level.mode].levelType == "editHistory"/* || level[level.mode].rotating.rotatingDreieck == false*/) angle = (level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].angle / 58);
      if (level[level.mode].rotating.rotatingDreieck == true && i == level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck.length - 1) level[level.mode].rotating.rotatingDreieck = false;
      canvas.rotate(angle);
      fillStyle && (canvas.fillStyle = fillStyle, canvas.fill(path));
      strokeStyle && (canvas.strokeStyle = strokeStyle, canvas.stroke(path));
    }


    function renderLoop(time) {
      //  canvas.clearRect(0, 0, textur.width, textur.height);
      //  if (!(level[level.mode].levelType == "editHistory")) Layout();
      const scale = Math.sin(time / 500) * 0.2 + 1.0;
      const scale2 = Math.cos(time / 1000) * 0.4 + 1.0;
      AblageListe[0] = time
  //    if (/*offline == true && */level[level.mode].levelType != "editHistory" && (level[level.mode].rotatingNow == "rotatingDreieck" || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined) ) Layout();
    //  if (level[level.mode].levelType == "vorgefertigt") Layout();
      for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck != undefined && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck.length; i++) {
        time = AblageListe[0];
        time += level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].angle * 10000
          if (i == level[level.mode].editLevel.selected[1] && level[level.mode].levelType == "editHistory" && level[level.mode].editLevel.selected[0] == "rotatingDreieck") drawPath_V2(triangle, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].x, level[level.mode][level[level.mode].levelType][level[level.mode].number]
            .rotatingDreieck[i].y, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].size / 10 /*level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].size*/ , time / (level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].timeFor360GradRotation) *
            Math.PI /*level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].angle*/ , "blue", "blue", i); //360 every 2 second
          else drawPath_V2(triangle, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].x, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].y, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].size / 10 /*level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].size*/ ,
            time / (level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].timeFor360GradRotation) * Math.PI /*level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].angle*/ , "black", "black", i); //360 every 2 second
      }
      // scale path
      //  drawPath_V2(rectangle, 125, 125, scale, time / 2000 * Math.PI, "black"); //360 every 4 second

      canvas.setTransform(1, 0, 0, 1, 0, 0);
      //  requestAnimationFrame(renderLoop);
    }

    function createPath(...points) {
      var cx = 0;
      cy = 0;
      for (const p of points) {
        cx += p.x;
        cy += p.y;
      }
      cx /= points.length;
      cy /= points.length;

      const path = new Path2D;
      for (const p of points) {
        path.lineTo(p.x - cx, p.y - cy);
      }
      path.closePath();
      return path;
    }

    function rotatingDreieck() {
      if (!(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined/* || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined*/)) {
        requestAnimationFrame(renderLoop); // start animation
      }
      //   if (!(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[0].angle == undefined)) Layout();
      //   for (var i = 0; !(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[0].angle == undefined) && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck.length; i++) {
      //   canvas.save();
      //   canvas.beginPath();
      //
      //     // canvas.moveTo(0, -canvas.width/2 * (Math.sqrt(3)/2) / 2);
      //     // canvas.lineTo(0, -(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].x / 2), canvas.width/2 * (Math.sqrt(3)/2) / 2);
      //     // canvas.lineTo((level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].x / 2) / 2, canvas.width/2 * (Math.sqrt(3)/2) / 2);
      //     // canvas.lineTo(0, -canvas.width/2 * (Math.sqrt(3)/2) / 2);
      //     canvas.fillStyle = "black";
      //     var path=new Path2D();
      //     path.moveTo(-50+50,-(25/2));
      //     path.lineTo(-50,-(25/2)-50);
      //     path.lineTo(-50-50,-(25/2));
      //     canvas.fill(path);
      //
      // canvas.closePath();
      // canvas.restore();
      // level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingDreieck[i].angle++;
      // }

    }

    function rotatingWall(rotate) {
      //if (!(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[0].angle == undefined) && !(level[level.mode].levelType == "editHistory")) Layout();
      if (offline == true && level[level.mode].levelType == "vorgefertigt") level[level.mode].rotatingNow = "rotatingWall";
  //    if (level[level.mode].levelType == "vorgefertigt") {rotate = true;Layout();}
      for (var i = 0; !(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[0].angle == undefined) && i < level[level.mode][level[level.mode].levelType][
          level[level.mode].number
        ].rotatingWall.length; i++) {
        canvas.save();
        canvas.translate(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].x, level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].y);
        canvas.rotate(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].angle * Math.PI / 180)
        if (i == level[level.mode].editLevel.selected[1] && level[level.mode].levelType == "editHistory" && level[level.mode].editLevel.selected[0] == "rotatingWall") canvas.fillStyle = "blue";
        else canvas.fillStyle = "black";
        canvas.fillRect(-(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].width / 2), -(level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].height / 2), level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].width, level[level.mode][level[level.mode].levelType][level[level.mode].number]
          .rotatingWall[i].height);
        canvas.restore();
        if (!(level[level.mode].levelType == "editHistory") && level[level.mode].rotating.rotatingWall == true) level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall[i].angle++;
        if (level[level.mode].levelType != "vorgefertigt" && level[level.mode].rotating.rotatingWall == true && i == level[level.mode][level[level.mode].levelType][level[level.mode].number].rotatingWall.length - 1) level[level.mode].rotating.rotatingWall = false;
      }
    }

    function boundingBoxCheck() {
      if (x1 < 0) {
        x1 = 0;
        vx1 = -vx1;
      }
      if (y1 < 0) {
        y1 = 0;
        vy1 = -vy1;
      }
      if (x1 > window.innerWidth - JSON.parse(sphere1.style.width.toString().split('px')[0]) / 2) {
        x1 = window.innerWidth - JSON.parse(sphere1.style.width.toString().split('px')[0]) / 2;
        vx1 = -vx1;
      }
      if (y1 > AblageListe[5] - JSON.parse(sphere1.style.height.toString().split('px')[0]) / 2) {
        y1 = AblageListe[5] - JSON.parse(sphere1.style.height.toString().split('px')[0]) / 2;
        vy1 = -vy1;
      }
      if (x2 < 0) {
        x2 = 0;
        vx2 = -vx2;
      }
      if (y2 < 0) {
        y2 = 0;
        vy2 = -vy2;
      }
      if (x2 > window.innerWidth - JSON.parse(sphere1.style.width.toString().split('px')[0]) / 2) {
        x2 = window.innerWidth - JSON.parse(sphere1.style.width.toString().split('px')[0]) / 2;
        vx2 = -vx2;
      }
      if (y2 > AblageListe[5] - JSON.parse(sphere1.style.height.toString().split('px')[0]) / 2) {
        y2 = AblageListe[5] - JSON.parse(sphere1.style.height.toString().split('px')[0]) / 2;
        vy2 = -vy2;
      }
      if (Bild.src == "https://adi.nicolaiweitkemper.de/Bilder/Gewinnerbildschirm.jpeg" || document.getElementById('ballStyleSelection').value == "party") {
        sphere1.style.backgroundColor = "rgba(" + Math.round(Math.random()*255) + ", " + Math.round(Math.random()*255) + ", "+ Math.round(Math.random()*255) + ",1)";
      }
    }

    function Layout(changingSize) {
      if (level[level.mode].levelType == "vorgefertigt" || level[level.mode].levelType == "winnerScreen") {
        canvas.drawImage(Bild, 0, 0, window.innerWidth, AblageListe[5])
      } else canvas.drawImage(document.getElementById('preview'), 0, 0, window.innerWidth, AblageListe[5]);
      //  if (level[level.mode].levelType == "editHistory"/* || level[level.mode].levelType == "editLevel" */|| level[level.mode].levelType == "worldWideLevel") {
      //    größeAnpassen();
      //}
      for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number] != undefined && level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet != undefined && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet.length; i++) {
        if (level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position != undefined && level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position.x != undefined) drawBullet(level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i]);
      }
      if (level[level.mode].rotatingNow != "rotatingWall") rotatingWall();
      if (level[level.mode].rotatingNow != "rotatingDreieck") rotatingDreieck();
      if (!(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined || level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall == undefined) && level[level.mode].rotating.blinkWall.includes(true)) blinkWall();
      // if (((level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "editHistory" || level[level.mode].levelType == "worldWideLevel") && !(level[level.mode].rotatingNow == "rotatingWall") || (((level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "editHistory" || level[level.mode].levelType == "worldWideLevel") && !(level[level.mode].rotatingNow == "rotatingDreieck")))) || level[level.mode].rotatingNow == "rotatingWall") rotating();
      // if (!(level[level.mode].rotating.blinkWall == undefined) && level[level.mode].rotating.blinkWall.includes(true)) blinkWall();
      if (level[level.mode].levelType == "editHistory") {
        level[level.mode].number = level[level.mode].stepOfHistory;
        canvas.drawImage(document.getElementById('preview'), 0, 0, window.innerWidth, AblageListe[5]);
        AblageListe[1] = ["rotatingWall", "rotatingDreieck", "blinkWall", "bullet"];
        for (var i = 0; level[level.mode].stepOfHistory > -1 && i < Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory]).length; i++) {
          if (!(Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i] == "picture"))
            for (var i1 = 0; (AblageListe[1].includes(Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i]) && i1 < level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]].length); i1++) {
              if (Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i] == "rotatingWall") rotatingWall(false);
              if (Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i] == "rotatingDreieck") rotatingDreieck(false);
              if (Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i] == "blinkWall") blinkWall();
            }
        }
      }
      //if (level[level.mode].levelType == "editHistory"/* || level[level.mode].levelType == "editLevel" */|| level[level.mode].levelType == "worldWideLevel") level[level.mode][level[level.mode].levelType] = JSON.parse(JSON.stringify(AblageListe[1]));
      if (level[level.mode].levelType == "editHistory" && changingSize != true) {
        canvas.fillStyle = "blue"
        canvas.beginPath();
        canvas.arc(level[level.mode].editHistory.spawnPoint.x + level[level.mode].editHistory.ballSize/2, level[level.mode].editHistory.spawnPoint.y + level[level.mode].editHistory.ballSize/2,level[level.mode].editHistory.ballSize/2,0,Math.PI*2, false);
        canvas.fill();
      }
    }

    function größeAnpassen() {
      //  AblageListe[1] = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType]));
      if (level[level.mode].levelType == "editHistory") AblageListe[2] = level[level.mode].editHistory[level[level.mode].stepOfHistory];
      else AblageListe[2] = JSON.parse(JSON.stringify(level[level.mode][level[level.mode].levelType]));
      for (var i = 0; i < Object.keys(AblageListe[2]).length; i++) {
        if (!(Object.keys(AblageListe[2])[i] == "picture")) {
          for (var i1 = 0; i1 < AblageListe[2][Object.keys(AblageListe[2])[i]].length; i1++) {
            if (!(AblageListe[2].screenXOriginal == undefined) && !(AblageListe[2].screenXOriginal == window.innerWidth && AblageListe[2].screenYOriginal == AblageListe[5])) {
              //  if (!(AblageListe[2][Object.keys(AblageListe[2])[i]] == "rotatingDreieck")) {
              // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].x = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].x + (window.innerWidth - AblageListe[2].screenXOriginal);
              // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].y = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].y + (AblageListe[5] - AblageListe[2][Object.keys(AblageListe[2])[i]][i1].screenYOriginal);
              //  }
              // window.innerWidth/(1600/300)
              AblageListe[2][Object.keys(AblageListe[2])[i]][i1].x = window.innerWidth / (AblageListe[2].screenXOriginal / AblageListe[2][Object.keys(AblageListe[2])[i]][i1].x);
              AblageListe[2][Object.keys(AblageListe[2])[i]][i1].y = AblageListe[5] / (AblageListe[2].screenYOriginal / AblageListe[2][Object.keys(AblageListe[2])[i]][i1].y);
              // if ([Object.keys(AblageListe[2])[i]][i1] == "rotatingWall") {
              //   // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width + ((window.innerWidth - AblageListe[2].screenXOriginal)/2);
              //   // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height + ((AblageListe[5] - AblageListe[2][Object.keys(AblageListe[2])[i]][i1].screenYOriginal)/2);
              // }
              // if ([Object.keys(AblageListe[2])[i]][i1] == "blinkWall") {
              //   // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width + ((window.innerWidth - AblageListe[2].screenXOriginal));
              //   // AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height = AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height + ((AblageListe[5] - AblageListe[2][Object.keys(AblageListe[2])[i]][i1].screenYOriginal));
              // }
              if ([Object.keys(AblageListe[2])[i]][i1] == "rotatingDreieck") AblageListe[2][Object.keys(AblageListe[2])[i]][i1].size = window.innerWidth / (AblageListe[2].screenXOriginal / AblageListe[2][Object.keys(AblageListe[2])[i]][i1].size);
              else {
                AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width = window.innerWidth / (AblageListe[2].screenXOriginal / AblageListe[2][Object.keys(AblageListe[2])[i]][i1].width);
                AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height = AblageListe[5] / (AblageListe[2].screenYOriginal / AblageListe[2][Object.keys(AblageListe[2])[i]][i1].height);
              }
            }
          }
        }
      }
    }
    // stopWatch:
    var time = 0;
    var running = 0;

    function startPause() {
      if (running == 0) {
        console.log("start");
        running = 1;
        time = 0;
        increment();
      } else {
        running = 0;
        console.log("pause");
      }
    }

    function reset() {
      running = 0;
      timer = 0;
    }

    function increment() {
      if (running == 1) {
        setTimeout(function() {
          time++;
          mins = Math.floor(time / 10 / 60);
          secs = Math.floor(time / 10);
          secs -= 60 * mins;
          tenths = time % 10;
          if (mins < 10) {
            mins = "0" + mins
          }
          if (secs < 10) {
            secs = "0" + secs;
          }
          increment();
        }, 100);
      }
    }

    function select(type) {
      level[level.mode].rotatingNow = type;
      document.getElementById(level[level.mode].editLevel.selected[0]).style.background = "";
      if (level[level.mode].editHistory.length == 0) level[level.mode].editLevel.selected = [type, 0];
      else if (level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]] == undefined) level[level.mode].editLevel.selected = [type, 0];
      else level[level.mode].editLevel.selected = [type, level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]].length - 1];
      document.getElementById(type).style.background = "blue";
    }
    visible([
      /*['blinkWall', "none"],
      ['rotatingWall', "none"],
      ['rotatingDreieck', "none"],
      ['testLevel', "none"],*/
    //["courceSelectionEdit", "none"]
      ['levelEditTool', "none"]
    ]);
    // document.getElementById('blinkWall').style.display = "none";
    // document.getElementById('rotatingWall').style.display = "none";
    // document.getElementById('rotatingDreieck').style.display = "none";
    // level[level.mode].editLevel.selected = [];
    level[level.mode].editLevel.selected = ["blinkWall", 0];
    document.getElementById("blinkWall").style.background = "blue";

    function activateBlinkWall() {
      level[level.mode].blinkWall = true;
      for (var i = 0; !(level[level.mode][level[level.mode].levelType][level[level.mode].number] == undefined) && !(level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall == undefined) && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length; i++) {
        if (level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].beginningTime == undefined) level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].beginningTime = 0;
        blinkWallFunction(i, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].beginningTime);
      }
    }

    function blinkWallFunction(i, beginningTime) {
      setTimeout(function () {
        setTimeout(function() {
          level[level.mode].rotating.blinkWall[i] = true;
          /*if (level[level.mode].levelType == "worldWideLevel")*/ Layout();
          setTimeout(function() {
            level[level.mode].rotating.blinkWall[i] = false;
            /*if (level[level.mode].levelType == "worldWideLevel")*/ Layout();
            if (/*level[level.mode].levelType == "editLevel" || level[level.mode].levelType == "worldWideLevel" && level[level.mode].blinkWall == true*/ level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall.length > i) blinkWallFunction(i, 0);
          }, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].timeVisible);
        }, level[level.mode][level[level.mode].levelType][level[level.mode].number].blinkWall[i].timeInvisible);
      }, beginningTime);
    }

    function activateBullets() {
      for (var i = 0; level[level.mode][level[level.mode].levelType][level[level.mode].number] && level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet != undefined && i < level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet.length; i++) {
        level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.done = 0;
        bulletInterval[i] = true;
        bullet(i, level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i], level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].startPointInSec, level[level.mode].levelType, level[level.mode].number);
      }
    }
    function bullet(i, levelAktuell, waitingTimeInSec, type, number) {
      level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position = {x: level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].startPosition.x, y: level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].startPosition.y};
      setTimeout(function () {
        bulletInterval[i] = true;
        setTimeout(function () {
          bulletInterval[i] = false;
          level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.done++;
          if (level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.need == "endless" && level[level.mode].levelType == type && level[level.mode].number == number)  bullet(i, level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i], 0, type, number);
          else if (level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.done < level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.need) bullet(i, level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i], levelAktuell.repetitions.beginningtimes[level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].repetitions.done - 1], type, number);
        }, levelAktuell.repeatIntervalIn_Secs*1000);
        movingBullet(levelAktuell, i);
        //   bulletInterval = setInterval(function () {
        // }, levelAktuell.pxPerMiliSec);
      }, waitingTimeInSec*1000);
    }
    function movingBullet(levelAktuell, i) {
      if (levelAktuell.direction == "right") level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position.x += levelAktuell.pxPerMiliSec;
      if (levelAktuell.direction == "left") level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position.x -= levelAktuell.pxPerMiliSec;
      if (levelAktuell.direction == "down") level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position.y += levelAktuell.pxPerMiliSec;
      if (levelAktuell.direction == "up") level[level.mode][level[level.mode].levelType][level[level.mode].number].bullet[i].position.y -= levelAktuell.pxPerMiliSec;
      Layout();
      setTimeout(function () {
        if (bulletInterval[i] == true) movingBullet(levelAktuell, i);
      }, 1);
    }
    function drawBullet(levelAktuell) {
      canvas.fillStyle = "black";
      canvas.beginPath();
      canvas.arc(levelAktuell.position.x,levelAktuell.position.y,levelAktuell.radius,100,Math.PI*2, true);
      canvas.fill();
    }
    function canvasClicked() {
      if (level[level.mode].levelType == "editHistory") {
        if (AblageListe[9] == "setSpawnpoint") {
          AblageListe[9] = "beendet";
          level[level.mode].editHistory.spawnPoint = {x: mausx - JSON.parse(sphere1.style.width.toString().split('px')[0])/2 - 10, y: mausy - JSON.parse(sphere1.style.height.toString().split('px')[0])/2 - 10};
          Layout();
        }
        else {
          AblageListe[0] = [];
          AblageListe[0][0] = [];
          AblageListe[0][1] = [];
          AblageListe[0][2] = [];
          AblageListe[0][3] = [];
          AblageListe[0][4] = [];

          AblageListe[0][5] = ["rotatingWall", "rotatingDreieck", "blinkWall", "bullet"];
          for (var i = 0; level[level.mode].stepOfHistory > -1 && i < Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory]).length; i++) {
            for (var i1 = 0; (AblageListe[0][5].includes(Object.keys(level[level.mode]["editHistory"][level[level.mode].stepOfHistory])[i]) && i1 < level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]].length); i1++) {
              if (Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i] == "picture") i1 = level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]].length;
              else {
                AblageListe[0][0].push(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1].x);
                AblageListe[0][1].push(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1].y);
                AblageListe[0][2].push(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1].width);
                AblageListe[0][3].push(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1].hight);
                AblageListe[0][4].push([i, i1]);
              }
            }
          }
          for (var i = 0; i < AblageListe[0][0].length; i++) {
            if ((AblageListe[0][0][i] - mausx < 55 && AblageListe[0][0][i] - mausx > -55) && (AblageListe[0][1][i] - mausy < 55 && AblageListe[0][1][i] - mausy > -55)) {
              console.log(AblageListe[0][4][i])
              console.log(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[AblageListe[0][4][i][0]]]
                [AblageListe[0][4][i][1]]);
              AblageListe[0][0] = i;
              i = AblageListe[0][1].length + 1;
            }
          }
          if (i == AblageListe[0][1].length + 2 && AblageListe[6] == true) {
            document.getElementById(level[level.mode].editLevel.selected[0]).style.background = "";
            level[level.mode].editLevel.selected[0] = Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[AblageListe[0][4][AblageListe[0][0]][0]]; //[AblageListe[0][0]];
            level[level.mode].editLevel.selected[1] = [AblageListe[0][4][AblageListe[0][0]][1]];
            document.getElementById(level[level.mode].editLevel.selected[0]).style.background = "blue";
            Layout();
            visibilityEditStuff();
            for (var i = 0; i < Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]]).length; i++) {
              if (Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i] == "width" || Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[
                  i] == "height" || Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i] == "size") document.getElementById("slider" + capitalizeFirstLetter(Object.keys(level[level.mode].editHistory[
                level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i])).value = level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory]
                [level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i]];
              else if (!(document.getElementById(Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i]) == undefined))
                document.getElementById(Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i]).value = level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[
                  1]][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editLevel.selected[1]])[i]];
            }
          } else {
            console.log("createElement");
            //  level[level.mode].stepOfHistory++;
            if (level[level.mode].editHistory.length > 0) {
              level[level.mode].editHistory.push(JSON.parse(JSON.stringify(level[level.mode].editHistory[level[level.mode].stepOfHistory])));
            } else {
              level[level.mode].editHistory.push({});
            }
            if (level[level.mode].editHistory.length == 1) level.normal.editHistory.unshift([]);
            level[level.mode].stepOfHistory = level[level.mode].editHistory.length - 1;
            level[level.mode].number = level[level.mode].stepOfHistory;
            if (level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]] == undefined) level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]] = [];
            level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].push({
              x: mausx,
              y: mausy /* - 17 - scrollY*/ ,
              angle: 0
            })
      //      level[level.mode].editHistory[level[level.mode].editHistory.length - 1].spawnPoint = {x: 10, y: 255};
            level[level.mode].editHistory/*[level[level.mode].editHistory.length - 1]*/.sensibility = 5;
            document.getElementById('angle').style.display = "inline";
            visibilityEditStuff();
            if (level[level.mode].editLevel.selected[0] == "rotatingWall") level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] = 3000;
            if (level[level.mode].editLevel.selected[0] == "blinkWall") {
              //    visible([['timeVisible', "inline"], ['timeInvisible', "inline"]]);
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeVisible"] = document.getElementById('timeVisible').value;
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeInvisible"] = document.getElementById('timeInvisible').value;
            }
            //  else visible([['timeVisible', "none"], ['timeInvisible', "none"]]);
            if (!(level[level.mode].editLevel.selected[0] == "rotatingDreieck")) {
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["width"] = document.getElementById('sliderWidth').value;
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["height"] = document.getElementById('sliderHeight').value;
              //    visible([['sliderSize', "none"], ['timeFor360GradRotation', "none"], ['sliderWidth', "inline"], ['sliderHeight', "inline"]])
              // document.getElementById('sliderSize').style.display = "none";
              // document.getElementById('timeFor360GradRotation').style.display = "none";
              // document.getElementById('sliderWidth').style.display = "inline";
              // document.getElementById('sliderHeight').style.display = "inline";
            } else {
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["size"] = document.getElementById('sliderSize').value;
              level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1]["timeFor360GradRotation"] = document.getElementById(
                'timeFor360GradRotation').value;
              //    visible([["sliderSize", "inline"], ['sliderWidth', "none"], ['sliderHeight', "none"], ['timeFor360GradRotation', "inline"]]);
              // document.getElementById('sliderSize').style.display = "inline";
              // document.getElementById('sliderWidth').style.display = "none";
              // document.getElementById('sliderHeight').style.display = "none";
              // document.getElementById('timeFor360GradRotation').style.display = "inline";
            }
            if (level[level.mode].editLevel.selected[0] == "blinkWall") {
              document.getElementById('angle').style.display = "none";
            }
            //  else document.getElementById('angle').style.display = "inline";
            level[level.mode].editLevel.selected[1] = level[level.mode].editHistory[level[level.mode].editHistory.length - 1][level[level.mode].editLevel.selected[0]].length - 1;
            Layout();
          }
        }
      }
      for (var i = level[level.mode].editHistory.length - 1; level[level.mode].editHistory[i] != undefined && Object.keys(level[level.mode].editHistory[i]).length == 0; i--) {
        level[level.mode].editHistory.pop();
      }
    }

    function readMouseMove(e) {
      mausx = e.clientX + scrollX;
      mausy = e.clientY + scrollY;
      //  console.log(mausx + " - " + mausy);
    }
    document.onmousemove = readMouseMove

    var f = function() {
      var eventHandler = function(event) {
        //  console.log(window.scrollX + " - " + window.scrollY);
        console.log("scroll - " + scrollY);
      };
      window.addEventListener('scroll', eventHandler, false)
    };
    window.addEventListener('DOMContentLoaded', f, false)

    function visible(list) {
      for (var i = 0; i < list.length; i++) {
        document.getElementById(list[i][0]).style.display = list[i][1];
      }
    }
    AblageListe[3] = false;

    function saveLevel() {
      if (AblageListe[3] == false) {
        AblageListe[3] = true;
        AblageListe[0] = {};
        for (var i = 0; i < Object.keys(level[level.mode].editLevel).length; i++) {
          if (!(Object.keys(level[level.mode].editLevel)[i] == "selectedLevel" || Object.keys(level[level.mode].editLevel)[i] == "selected" || Object.keys(level[level.mode].editLevel)[i] == "Test")) AblageListe[0][Object.keys(level[level.mode].editLevel)[i]] = level[level.mode].editLevel[Object.keys(level[level.mode].editLevel)[i]];
        }
        Layout();
        localStorage.setItem("levelBy " + name, JSON.stringify(AblageListe[0]));
        if (offline == false) {
        dbSet("Gelduldspiel", "levelBy " + name, AblageListe[0]);
        alert("saving...")
        var checkLevelSaved = setInterval(function() {
          dbGet("Gelduldspiel", "levelBy " + name).then(result => {
            if (angular.equals(Object.keys(level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel]), Object.keys(result[level[level.mode].editLevel.selectedLevel]))) {
              alert("level saved!");
              clearInterval(checkLevelSaved);
              AblageListe[3] = false;
            }
            // else {
            //   dbSet("Gelduldspiel", "levelBy " + name, AblageListe[0]);
            // }
          }).catch(function(e) {
            console.error(e);
          });
        }, 1000);
      }
      }
    }
    document.onkeydown = function(event) {
      folgenKeyPressed(event);
    }
    function folgenKeyPressed(event) {
      setTimeout(function () {
        Layout();
      }, 100);
      console.log(event)
      if (level[level.mode].levelType == "editHistory" && event.key.toLowerCase() == "s" && event.ctrlKey == true) {
        level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel] = level[level.mode].editHistory[level[level.mode].stepOfHistory];
        canvas.drawImage(document.getElementById('preview'), 0, 0, window.innerWidth, AblageListe[5]);
        if (AblageListe[4] == false) level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].picture = textur.toDataURL();
        else level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].picture = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/" + document.getElementById('modeSelection').value + "/GeduldsspielMap" + document.getElementById('courceSelectionEdit').value.toString().split('.')[0] + ".png";
        if (level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenXOriginal == undefined) {
          level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenXOriginal = window.innerWidth;
          level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].screenYOriginal = AblageListe[5];
        }
        level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].spawnPoint = level[level.mode].editHistory.spawnPoint;
        level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].sensibility = level[level.mode].editHistory.sensibility;
        level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].ballSize = level[level.mode].editHistory.ballSize;
        if (level.mode == "growing")   level[level.mode].editLevel[level[level.mode].editLevel.selectedLevel].beginningSize = level[level.mode].editHistory.beginningSize;
        saveLevel();
      }
      if (level[level.mode].levelType == "editHistory" && event.key == "z" && event.ctrlKey == true && level[level.mode].stepOfHistory == level[level.mode].editHistory.length - 1 && (offline != true && angular.equals(level[level.mode].editHistory[level[level.mode].editHistory.length - 1], level[level.mode].editHistory[level[level.mode].editHistory.length -
          2])) || (offline == true && level[level.mode].editHistory[level[level.mode].editHistory.length - 1] == level[level.mode].editHistory[level[level.mode].editHistory.length -2])) {
            level[level.mode].stepOfHistory--;
          }
      if (level[level.mode].levelType == "editHistory" && event.key == "z" && event.ctrlKey == true && level[level.mode].stepOfHistory > 0) level[level.mode].stepOfHistory--;
      // why should I?:   if (level[level.mode].levelType == "editHistory" && event.key == "z" && event.ctrlKey == true && level[level.mode].stepOfHistory == 0 && !(Object.keys(level[level.mode].editHistory[0]).length == 0)) level[level.mode].editHistory.unshift([]);
      if (level[level.mode].levelType == "editHistory" && event.key == "y" && event.ctrlKey == true && level[level.mode].stepOfHistory < level[level.mode].editHistory.length - 1) level[level.mode].stepOfHistory++;
      if (level[level.mode].levelType == "editHistory" && (event.key == "z" || event.key == "y") && event.ctrlKey == true && level[level.mode].stepOfHistory > -1 && level[level.mode].stepOfHistory < level[level.mode].editHistory.length) {
        level[level.mode].number = level[level.mode].stepOfHistory;
        for (var i = level[level.mode].editHistory.length - 1; Object.keys(level[level.mode].editHistory[i]).length == 0 && level[level.mode].editHistory.length > 0; i--) {
          level[level.mode].editHistory.pop();
        }
        for (var i = 0; i < Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory]).length; i++) {
          for (var i1 = 0; i1 < level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]].length; i1++) {
            for (var i2 = 0; i2 < Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][0]).length; i2++) {
              // if (!(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]].length - 1 == undefined) && event.key == "y" && !(angular.equals(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]], level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory - 1])[i]]))) level[level.mode].editLevel.selected[0] = Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory - 1])[i];
              // if (!(level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]].length - 1 == undefined) && event.key == "z" && !(angular.equals(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]], level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory + 1])[i]])))level[level.mode].editLevel.selected[0] = Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory] + 1)[i];
              if (!(document.getElementById(level[level.mode].editLevel.selected[0]) == undefined) && (level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]] == undefined)) {
                document.getElementById(level[level.mode].editLevel.selected[0]).style.background = "";
                level[level.mode].editLevel.selected[0] = Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[0];
                document.getElementById(level[level.mode].editLevel.selected[0]).style.background = "blue";
              };
              if (Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2] == "width" || Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[
                  i]][i1])[i2] == "height" || Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2] == "size")
                  document.getElementById("slider" + capitalizeFirstLetter(Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2])).value =
                  level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]].length - 1][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2]];
              else if (!(Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2] == "x" || Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[
                  i]][i1])[i2] == "y"))
                   document.getElementById(Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2]).value =
                   level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]][level[level.mode].editHistory[level[level.mode].stepOfHistory][level[level.mode].editLevel.selected[0]].length - 1][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory][Object.keys(level[level.mode].editHistory[level[level.mode].stepOfHistory])[i]][i1])[i2]];
            }
          }
        }
        Layout();
      }
      for (var i = level[level.mode].editHistory.length - 1; level[level.mode].editHistory.length > 0 && Object.keys(level[level.mode].editHistory[i]).length == 0; i--) {
        level[level.mode].editHistory.pop();
      }
    }

    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }
    function saveMapsVorgefertigt() {
      alert("WARNING: wait for all maps been shown on the screen. After that, it finished! you will also get a message then.");
      localStorage.setItem("profileName", name);
      localStorage.setItem("highscoresGeduldsspiel", JSON.stringify(highscores));
      localStorage.setItem("levelAroundTheWorld", JSON.stringify(level[level.mode].worldWideLevel))
      document.getElementById('textur').style.display = "inline";
      setTimeout(function () {
      AblageListe[7] = [];
      AblageListe[1] = [0, 0];
      if (offline == false) {
      var saveLevelFertig = setInterval(function () {
          if (!((AblageListe[1][0]/2 + "").includes("."))) AblageListe[1][1]++;
          console.log("i: " + AblageListe[1][1]);
          Bild = new Image();
          if (offline == false) Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/" + document.getElementById('modeSelection').value + "/GeduldsspielMap" + (AblageListe[1][1]) + ".png"
          else Bild.src = level[level.mode].mapsVorgefertigt[AblageListe[1][1]];
          canvas.drawImage(Bild, 0, 0, window.innerWidth, AblageListe[5]);
          if ((AblageListe[1][0]/2 + "").includes(".")) AblageListe[7].push(textur.toDataURL());
          if (AblageListe[1][1] >= Object.keys(level[level.mode].vorgefertigt).length && (AblageListe[1][0]/2 + "").includes(".")) {
          //  if (localStorage.getItem("mapsVorgefertigt") == null || !(angular.equals(JSON.parse(localStorage.getItem("mapsVorgefertigt")).length, AblageListe[7].length))) {
              localStorage.setItem("mapsVorgefertigt", JSON.stringify(AblageListe[7]));
              alert("level stored on device!");
        //    }
            level[level.mode].mapsVorgefertigt = AblageListe[7];
            clearInterval(saveLevelFertig);
          }
          AblageListe[1][0]++;
      }, 1500);
    }
    else {
      if (localStorage.getItem("mapsVorgefertigt") == null) alert("You have to be online first, to be able to store the maps for offline play!");
      else level[level.mode].mapsVorgefertigt = JSON.parse(localStorage.getItem("mapsVorgefertigt"));
    }
      // for (var i = 0; i < Object.keys(level[level.mode].vorgefertigt).length; i++) {
      //   Bild = new Image();
      //   if (offline == false) Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gelduldspiel/" + document.getElementById('modeSelection').value + "/GeduldsspielMap" + (i + 1) + ".png"
      //   else Bild.src = level[level.mode].mapsVorgefertigt[i];
      //   canvas.drawImage(Bild, 0, 0, window.innerWidth, AblageListe[5]);
      //   AblageListe[7].push(textur.toDataURL());
      // }
      console.log(AblageListe[7]);
      }, 3000);
    }
  </script>
</body>

</html>
