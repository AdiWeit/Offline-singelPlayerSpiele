<canvas id="textur" width="2570" height="800"></canvas>
<script>
  var textur = document.getElementById('textur');
  var canvas = textur.getContext('2d'); //Dimension
  var AblageListe = [];
  var zählerListe = [];
  var spielfeld = [];
  var KoordinatenX = 145;
  var KoordinatenY = 110;
  var zählerListe = [];
  var mausx = 0;
  var mausy = 0;
  var zustände = [];
  var felderAuswahl = [];


  zahlenKreieren();
  spielfeldKreieren();

  /*canvas.fillStyle = "blue"
  canvas.beginPath();
  canvas.arc(110,110,99,0,Math.PI*2, false);
  canvas.fill();
  canvas.fillStyle = "red"
  canvas.beginPath();
  canvas.arc(110,110,90,0,Math.PI*2, false);
  canvas.fill();
  */

  function spielfeldKreieren() {
    canvas.fillStyle = "white"
    canvas.fillRect(0, 0, 1800, 700)
    zählerListe[0] = 0;
    zählerListe[1] = 0;
    KoordinatenX = 145;
    KoordinatenY = 110;
    while (KoordinatenY < 700) {
      if (felderAuswahl.includes(zählerListe[0] + " - " + zählerListe[1])) {
        canvas.fillStyle = "green";
      } else {
        canvas.fillStyle = "blue";
      }
      if (zählerListe[0] + " - " + zählerListe[1] == felderAuswahl[felderAuswahl.length - 1]) {
        canvas.fillStyle = "red"
      }

      canvas.beginPath();
      canvas.arc(KoordinatenX, KoordinatenY, 69, 0, Math.PI * 2, false);
      canvas.fill();
      canvas.fillStyle = "yellow"
      canvas.beginPath();
      canvas.arc(KoordinatenX, KoordinatenY, 60, 0, Math.PI * 2, false);
      canvas.fill();
      canvas.fillStyle = "black";
      //    canvas.
      if (zählerListe[0] + " - " + zählerListe[1] == felderAuswahl[felderAuswahl.length - 1] == false) {
        spielfeld[zählerListe[0]][zählerListe[1]] += "";
        canvas.font =  105 - 15 * spielfeld[zählerListe[0]][zählerListe[1]].length + "px Georgia";
        KoordinatenX += 10;
        KoordinatenX -= 10* spielfeld[zählerListe[0]][zählerListe[1]].length;
        canvas.fillText(spielfeld[zählerListe[0]][zählerListe[1]], KoordinatenX - 23, KoordinatenY + 23);
        KoordinatenX -= 10;
        KoordinatenX += 10* spielfeld[zählerListe[0]][zählerListe[1]].length;
      } else {
        AblageListe[1] = "";
        AblageListe[1] += zustände[1] * felderAuswahl.length;
        canvas.font =  105 - 15 * AblageListe[1].length + "px Georgia";
        KoordinatenX += 10;
        KoordinatenX -= 10* AblageListe[1].length;
        canvas.fillText(zustände[1] * felderAuswahl.length, KoordinatenX - 23, KoordinatenY + 23);
        KoordinatenX -= 10;
        KoordinatenX += 10* AblageListe[1].length;
      }
      KoordinatenX += 170;
      if (KoordinatenX > 1500) {
        KoordinatenX = 145;
        KoordinatenY += 170;
        zählerListe[0]++;
        zählerListe[1] = -1;
      }
      zählerListe[1]++;
    }
    if (spielfeld[0].includes("empty")) {
      removeEmpty();
      spielfeldKreieren();
    }
    if (spielfeld[1].includes("empty")) {
      removeEmpty();
      spielfeldKreieren();
    }
    if (spielfeld[2].includes("empty")) {
      removeEmpty();
      spielfeldKreieren();
    }
    if (spielfeld[3].includes("empty")) {
      removeEmpty();
      spielfeldKreieren();
    }
  }

  function zahlenKreieren() {
    zählerListe[0] = 0;
    zählerListe[1] = 0;
    while (zählerListe[0] < 4) {
      spielfeld[zählerListe[0]] = [];
      while (zählerListe[1] < 8) {
        spielfeld[zählerListe[0]][zählerListe[1]] = Math.floor(Math.random() * 4);
        spielfeld[zählerListe[0]][zählerListe[1]]++;
        spielfeld[zählerListe[0]][zählerListe[1]] = spielfeld[zählerListe[0]][zählerListe[1]] * 2
        zählerListe[1]++;
      }
      zählerListe[1] = 0;
      zählerListe[0]++;
    }
  }


  function readMouseMove(e) {
    mausx = e.clientX;
    mausy = e.clientY;
    //  console.log(e.clientX);

    if (zustände[0] == "Auswahl") {
      klickpointCheck();
      if (zählerListe[0] == 5 && felderAuswahl.includes(AblageListe[0]) == false && spielfeld[AblageListe[0].toString().split(' - ')[0]][AblageListe[0].toString().split(' - ')[1]] == zustände[1]) {
        felderAuswahl[felderAuswahl.length] = AblageListe[0];
        console.log(felderAuswahl);
      }
      if (zählerListe[0] == 5 && spielfeld[AblageListe[0].toString().split(' - ')[0]][AblageListe[0].toString().split(' - ')[1]] == zustände[1] && AblageListe[0] == felderAuswahl[felderAuswahl.length - 2]) {
        felderAuswahl.pop();
      }
      spielfeldKreieren();
    }
  }
  document.onmousemove = readMouseMove

  window.addEventListener('mousedown', function() {
    klickpointCheck();
    if (zählerListe[0] == 5) {
      if (zustände[0] == "Auswahl" == false) {
        zustände[0] = "Auswahl";
        felderAuswahl = [];
        felderAuswahl[0] = AblageListe[0];
        spielfeldKreieren();
      } else {
        zählerListe[0] = 0;
        while (zählerListe[0] < felderAuswahl.length - 1) {
          spielfeld[felderAuswahl[zählerListe[0]].toString().split(' - ')[0]][felderAuswahl[zählerListe[0]].toString().split(' - ')[1]] = "empty";
          zählerListe[0]++;
        }
        spielfeld[felderAuswahl[zählerListe[0]].toString().split(' - ')[0]][felderAuswahl[zählerListe[0]].toString().split(' - ')[1]] = zustände[1] * felderAuswahl.length
        spielfeldKreieren();
      }
    }
  });

  function klickpointCheck() {
    zählerListe[0] = 0;
    zählerListe[1] = 0;
    while (zählerListe[0] < 4) {
      while (zählerListe[1] < 8) {
        if (mausx > 80 + 170 * zählerListe[1] && mausx < 80 + 170 * zählerListe[1] + 138 && mausy > 50 + 170 * zählerListe[0] && mausy < 50 + 170 * zählerListe[0] + 138) {
          //console.log(zählerListe[0] + " - " + zählerListe[1]);
          AblageListe[0] = zählerListe[0] + " - " + zählerListe[1]
          if (zustände[0] == "Auswahl" == false) {

            zustände[1] = spielfeld[zählerListe[0]][zählerListe[1]];
          }
          zählerListe[0] = 4;
        }
        zählerListe[1]++;
      }
      zählerListe[1] = 0;
      zählerListe[0]++;
    }
  }

  document.onkeydown = function(event) {
    if (event.keyCode == 46) {
      zustände[0] = "beendet";
      felderAuswahl = [];
      spielfeldKreieren();
    }

  };

  function removeEmpty() {
    zählerListe[0] = 3;
    zählerListe[1] = 7;
    while (zählerListe[0] > 0) {

      while (zählerListe[1] > -1) {
        if (spielfeld[zählerListe[0]][zählerListe[1]] == "empty") {
          if (zählerListe[0] > 0) {
            spielfeld[zählerListe[0]][zählerListe[1]] = spielfeld[zählerListe[0] - 1][zählerListe[1]]
            spielfeld[zählerListe[0] - 1][zählerListe[1]] = "empty";
          } else {
            spielfeld[zählerListe[0]][zählerListe[1]] = Math.floor(Math.random() * 4);

            spielfeld[zählerListe[0]][zählerListe[1]]++;
            spielfeld[zählerListe[0]][zählerListe[1]] *= 2;
          }

        }


        if (zählerListe[1] == 0 && zählerListe[0] == 0 == false) {
          zählerListe[0]--;
          zählerListe[1] = 9;
        }
        zählerListe[1]--;
      }
    }
    zustände[0] = "beendet";
    felderAuswahl = [];
    spielfeldKreieren();
  }
</script>
