<title>Geduldspiel</title>
<canvas id="textur" width="1582" onclick="canvasClicked();" height="740"></canvas>
<div id="ball">
  <style>
    .shape {
 position: absolute;
 width: 50px;
 height: 50px;
 -webkit-radius: 50px;
 margin:0;width
 padding:0;
}
#sphere1{
 border-radius: 50px;
 background-color: blue;
}
#sphere2{
 border-radius: 50px;
 background-color: red;
}
</style>
</div>
<div id="content">
  <div class="shape" id="sphere1"></div>
</div>
<div id="content">
  <div class="shape" id="sphere2"></div>
</div>


<script>
    var canvas = textur.getContext('2d'); //Dimension
    var x1 = 10,
    y1 = 177; //window.innerHeight - 150 + 3,
  x2 = 0, y2 = 0,
  vx1 = 0, vy1 = 0,
  vx2 = 0, vy2 = 0,
  ax1 = 0, ay1 = 0;

    var sphere = {schieber: document.getElementById("sphere1"), ball: document.getElementById("sphere2")};
    sphere.schieber.style.width = "50px";
    sphere.schieber.style.height = "50px";
    sphere.schieber.style.ball = "50px";
    sphere.schieber.style.ball = "50px";
    var level = {aktuell: 0, mode: "normal", normal: {1: {spawnPoint: {
      schieber: {x: 177, y: 200}, ball: {x: 177, y: 250}}, ball: {width: 50, height: 50}}}};
    var Bild = new Image();
    if (window.DeviceMotionEvent != undefined) {
  window.ondevicemotion = function(e) {
    ax1 = inOrAgainstDirection*event.accelerationIncludingGravity.x * 17;
    ay1 = inOrAgainstDirection*event.accelerationIncludingGravity.y * 17;
  }
  setInterval(function() {
    var landscapeOrientation = window.innerWidth / Bild.width > 1;
    if (landscapeOrientation) {
      vx1 = vx1 + ay1;
      vy1 = vy1 + ax1;
      vx2 = vx2 + ay1;
      vy2 = vy2 + ax1;
    } else {
      vy1 = vy1 - ay1;
      vx1 = vx1 + ax1;
      vy2 = vy2 - ay1;
      vx2 = vx2 + ax1;
    }
    vx1 = vx1 * 0.98;
    vy1 = vy1 * 0.98;
    y1 = parseInt(y1 + vy1 / 50);
    x1 = parseInt(x1 + vx1 / 50);

    vx2 = vx2 * 0.98;
    vy2 = vy2 * 0.98;
    y2 = parseInt(y2 + vy2 / 30);
    x2 = parseInt(x2 + vx2 / 30);
    //  if (scrollY > 0) document.getElementById('sphere1').style.display = "none";
    boundingBoxCheck();
    sphere.schieber.style.top = y1 + "px";
    sphere.schieber.style.left = x1 + "px";
    ball.x = JSON.parse(sphere.ball.style.left.replace("px", ""));
    ball.y = JSON.parse(sphere.ball.style.top.replace("px", ""));
    if (isCollide({x: x1, y: y1, width: 50, height: 50}, ball) && directionBefore == "left") ball.x = x1 - cssToNumber(sphere.schieber.style.width)//-= 3;
    if (isCollide({x: x1, y: y1, width: 50, height: 50}, ball) && directionBefore == "right") ball.x = x1 + cssToNumber(sphere.schieber.style.width)//+= 3;
    if (isCollide({x: x1, y: y1, width: 50, height: 50}, ball) && directionBefore == "up") ball.y = y1 - cssToNumber(sphere.schieber.style.height)//-= 3;
    if (isCollide({x: x1, y: y1, width: 50, height: 50}, ball) && directionBefore == "down") ball.y = y1 + cssToNumber(sphere.schieber.style.height) //+= 3;
    sphere.ball.style.left = ball.x + "px";
    sphere.ball.style.top = ball.y + "px";
    var numbers = [
      [x1 + cssToNumber(sphere.schieber.style.width) - 7, y1 + cssToNumber(sphere.schieber.style.height) / 2],
      [x1 + cssToNumber(sphere.schieber.style.width) / 2, y1 - 8],
      [x1 + cssToNumber(sphere.schieber.style.width) / 2, y1 + cssToNumber(sphere.schieber.style.height) - 7],
      [x1 - 10, y1 + cssToNumber(sphere.schieber.style.height) / 2],

      [ball.x + cssToNumber(sphere.ball.style.width) - 7, ball.y + cssToNumber(sphere.ball.style.height) / 2],
      [ball.x + cssToNumber(sphere.ball.style.width) / 2, ball.y - 8],
      [ball.x + cssToNumber(sphere.ball.style.width) / 2, ball.y + cssToNumber(sphere.ball.style.height) - 7],
      [ball.x - 10, ball.y + cssToNumber(sphere.ball.style.height) / 2]
    ]
    for (var i = 0; i < 8; i++) {
      // canvas.fillStyle = "red";
      // canvas.fillRect(numbers[i][0] - 10, numbers[i][1] - 10, 10, 10);
      data = canvas.getImageData(numbers[i][0], numbers[i][1], 1, 1);
      red = data.data[0];
      green = data.data[1];
      blue = data.data[2];
      alpha = data.data[3];
      if (red == 0 && blue == 0 && alpha == 255 && green == 0) {
        console.log("Fail!");
        restartLevel();
      }
      if (red == 255 && blue == 0 && alpha == 255 && (green > 241)) {
        console.log("goal reached (yellow)");
        nextLevel();
      }
    }
  }, 25);
}

function boundingBoxCheck() {
  Layout();
  if (x1 < 0) {
    x1 = 0;
    vx1 = -vx1;
  }
  if (y1 < 0) {
    y1 = 0;
    vy1 = -vy1;
  }
  if (x1 > Bild.width - JSON.parse(sphere.schieber.style.width.toString().split('px')[0]) / 2) {
    x1 = Bild.width - JSON.parse(sphere.schieber.style.width.toString().split('px')[0]) / 2;
    vx1 = -vx1;
  }
  if (y1 > Bild.height - JSON.parse(sphere.schieber.style.height.toString().split('px')[0]) / 2) {
    y1 = Bild.height - JSON.parse(sphere.schieber.style.height.toString().split('px')[0]) / 2;
    vy1 = -vy1;
  }
  if (x2 < 0) {
    x2 = 0;
    vx2 = -vx2;
  }
  if (y2 < 0) {
    y2 = 0;
    vy2 = -vy2;
  }
  if (x2 > Bild.width - JSON.parse(sphere.schieber.style.width.toString().split('px')[0]) / 2) {
    x2 = Bild.width - JSON.parse(sphere.schieber.style.width.toString().split('px')[0]) / 2;
    vx2 = -vx2;
  }
  if (y2 > Bild.height - JSON.parse(sphere.schieber.style.height.toString().split('px')[0]) / 2) {
    y2 = Bild.height - JSON.parse(sphere.schieber.style.height.toString().split('px')[0]) / 2;
    vy2 = -vy2;
  }
}

function Layout() {
  Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/transportTheBall/map" + level.aktuell + ".png";
  canvas.drawImage(Bild, 0, 0);
}
var ball = {x: 0, y: 0, width: 50, height: 50};
nextLevel();
function restartLevel() {
  x1 = level[level.mode][level.aktuell].spawnPoint.schieber.x;
  y1 = level[level.mode][level.aktuell].spawnPoint.schieber.y;
  sphere.ball.style.top = level[level.mode][level.aktuell].spawnPoint.ball.y + "px";
  sphere.ball.style.left = level[level.mode][level.aktuell].spawnPoint.ball.x + "px";
}
function nextLevel() {
  level.aktuell++;
  restartLevel();
  ball.width =
  sphere.ball.style.width = ball.width + "px";
  sphere.ball.style.height = ball.height + "px";
}

var directionBefore = "";
function isCollide(a, b) {
if (((a.y + a.height) < (b.y))) directionBefore = "down";
if (((a.y > (b.y + b.height)))) directionBefore = "up";
if ((((a.x + a.width) < b.x))) directionBefore = "right";
if (((a.x > (b.x + b.width)))) directionBefore = "left";
if (!(
    ((a.y + a.height) < (b.y)) ||
    (a.y > (b.y + b.height)) ||
    ((a.x + a.width) < b.x) ||
    (a.x > (b.x + b.width))
)) {}
return !(
    ((a.y + a.height) < (b.y)) ||
    (a.y > (b.y + b.height)) ||
    ((a.x + a.width) < b.x) ||
    (a.x > (b.x + b.width))
);
}
var inOrAgainstDirection = 1;
modeSelected("normal");
function modeSelected(mode) {
  level.mode = mode;
  if (mode == "normal") {
    inOrAgainstDirection = 1;
  }
}

function cssToNumber(cssStyle) {
  return JSON.parse(cssStyle.toString().split('px')[0])
}

</script>
